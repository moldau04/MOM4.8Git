
@{
    ViewData["Title"] = " List Page";
    Layout = "~/Views/Shared/MOMLayout.cshtml";
}


<!--Grid Control-->
<link href="~/MOMUI/Design/css/grid.css" rel="stylesheet" />
<!--File Upload Control-->
<link href="~/MOMUI/Design/js/plugins/dropify/css/dropify.css" type="text/css" rel="stylesheet" media="screen,projection">
@*<%-- --OLD-----%>*@
<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
<link href="~/MOMUI/Design/js/Signature/jquery.signaturepad.css" rel="stylesheet" />
<script src="~/MOMUI/Design/js/Signature/jquery.signaturepad.js"></script>
@*<%--Map Script--%>*@
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.maskedinput/1.4.1/jquery.maskedinput.min.js"></script>
<script src="~/MOMUI/Design/js/jquery.ns-autogrow.js"></script>
<script src="~/MOMUI/Design/js/jquery.geocomplete.js"></script>
<script src="~/MOMUI/Design/js/Appearance/bootstrap-filestyle.js"></script>
<script src="~/MOMUI/Design/js/QuickCodes.js"></script>
<script src="~/MOMUI/Design/js/TimePicker/jquery.timepicker.js"></script>
<link href="~/MOMUI/Design/js/TimePicker/jquery.timepicker.css" rel="stylesheet" />

<script type="text/javascript">

    var requestInitiator = null;
    var selectionStart = null;

    function requestStart(sender, args) {
        requestInitiator = document.activeElement.id;
        if (document.activeElement.tagName == "INPUT") {
            selectionStart = document.activeElement.selectionStart;
        }
    }

    function responseEnd(sender, args) {
        var element = $(requestInitiator);
        if (element && element.tagName == "INPUT") {
            element.focus();
            element.selectionStart = selectionStart;
        }
    }

</script>


<style type="text/css">
    .lnkProcessInvoicingCss {
        display: none;
    }

    .highlight {
        background-color: Yellow;
    }

    .highlighted {
        background-color: Yellow;
    }
</style>

<script type="text/javascript">
    // Is automatically  Create New Project for the that Ticket
    function SaveTicket(varthis) {
        //Ref SECO-450 we should not create projects automatically

        var hdnIsCreateJob = $("#hdnIsCreateJob").val();
        var hdnProjectId = $("#hdnProjectId").val();
        var e = $("#ddlTemplate");
        var ddlTemplate = e.options[e.selectedIndex].val();
        var hdnQuickBooksIntegration = $("#hdnQuickBooksIntegration").val();

        if ($("#ddlStatus").val() == 4) {
            if (hdnProjectId == "0" || hdnProjectId == "" || hdnProjectId === undefined) {
                if (hdnQuickBooksIntegration == "0" || hdnQuickBooksIntegration == "" || hdnQuickBooksIntegration === undefined) {
                    if (hdnIsCreateJob == "0") {
                        if (confirm("Are you sure you want to add a new project?")) {
                            $("#hdnIsCreateJob").val('1');
                            if (ddlTemplate == 0) {

                                noty({ text: 'Please select the Project Template.', type: 'warning', layout: 'topCenter', closeOnSelfClick: true, timeout: 5000, theme: 'noty_theme_default', closable: false, dismissQueue: true });
                                return false;
                            }
                        }
                        else {
                            $("#txtProject").focus();
                            $("#DivProject").show();
                            return false;
                        }
                    }
                    else {
                        if (ddlTemplate == 0) {

                            noty({ text: 'Please select the Project Template.', type: 'warning', layout: 'topCenter', closeOnSelfClick: true, timeout: 5000, theme: 'noty_theme_default', closable: false, dismissQueue: true });
                            return false;
                        }
                    }
                }
            }

            //2 txtWorkCompl
            if ($("#txtWorkCompl").val() == "") {
                noty({ text: 'Please fill Work complete description.', type: 'warning', layout: 'topCenter', closeOnSelfClick: true, timeout: 5000, theme: 'noty_theme_default', closable: false, dismissQueue: true });
                $("#txtWorkCompl").focus();
                return false;
            }
            //3 ddlRoute
            var e3 = $("#ddlRoute");
            var ddlRoute = e3.options[e3.selectedIndex].val();
            if (ddlRoute == 0) {
                noty({ text: 'Please select worker.', type: 'warning', layout: 'topCenter', closeOnSelfClick: true, timeout: 5000, theme: 'noty_theme_default', closable: false, dismissQueue: true });
                $("#ddlRoute").focus();
                return false;
            }
        }

        // JAVA SCRIPT VALIDATION
        //1 customer
        if ($("#txtCustomer").val() == "") {
            noty({ text: 'Please select the customer.', type: 'warning', layout: 'topCenter', closeOnSelfClick: true, timeout: 5000, theme: 'noty_theme_default', closable: false, dismissQueue: true });
            $("#txtCustomer").focus();
            return false;
        }

        var e1 = $("#ddlCategory");
        var ddlCategory = e1.options[e1.selectedIndex].val();

        //3 category
        if (ddlCategory == 0) {
            noty({ text: 'Please select category.', type: 'warning', layout: 'topCenter', closeOnSelfClick: true, timeout: 5000, theme: 'noty_theme_default', closable: false, dismissQueue: true });
            $("#ddlCategory").focus();
            return false;
        }

        //4 txtReason
        if ($("#txtReason").val() == "") {
            noty({ text: 'Please fill Reason for Service.', type: 'warning', layout: 'topCenter', closeOnSelfClick: true, timeout: 5000, theme: 'noty_theme_default', closable: false, dismissQueue: true });
            $("#txtReason").focus();
            return false;
        }

        //5 Caller
        if ($("#txtNameWho").val() == "") {
            noty({ text: 'Please fill Caller.', type: 'warning', layout: 'topCenter', closeOnSelfClick: true, timeout: 5000, theme: 'noty_theme_default', closable: false, dismissQueue: true });
            $("#txtNameWho").focus();
            return false;
        }


        //6 city
        if ($("#txtCity").val() == "") {
            noty({ text: 'Please fill City.', type: 'warning', layout: 'topCenter', closeOnSelfClick: true, timeout: 5000, theme: 'noty_theme_default', closable: false, dismissQueue: true });
            $("#txtCity").focus();
            return false;
        }

        var e2 = $("#ddlState");


        if ($(e2).val() == "") {
            noty({ text: 'Please select state.', type: 'warning', layout: 'topCenter', closeOnSelfClick: true, timeout: 5000, theme: 'noty_theme_default', closable: false, dismissQueue: true });
            $("#ddlState").focus();
            return false;
        }


        // 8 Call In Time
        if ($("#txtCallTime").val() == "") {
            noty({ text: 'Please fill Called In Time.', type: 'warning', layout: 'topCenter', closeOnSelfClick: true, timeout: 5000, theme: 'noty_theme_default', closable: false, dismissQueue: true });
            $("#txtCity").focus();
            return false;
        }

        // 9 Scheduled Time
        if ($("#txtSchTime").val() == "") {
            noty({ text: 'Please fill Scheduled Time.', type: 'warning', layout: 'topCenter', closeOnSelfClick: true, timeout: 5000, theme: 'noty_theme_default', closable: false, dismissQueue: true });
            $("#txtCity").focus();
            return false;
        }

        disableButton(varthis, 'addticketVG');


        itemJSON();




        return true;
    }

    ///-Document permission
    function AddDocumentClick(hyperlink) {
        var IsAdd = $("#hdnAddeDocument").val();
        if (IsAdd == "Y") {
            ConfirmUpload(hyperlink.value);

        } else {
            noty({ text: 'You do not have permission!', type: 'warning', layout: 'topCenter', closeOnSelfClick: true, timeout: 5000, theme: 'noty_theme_default', closable: false, dismissQueue: true });
        }
    }

    function DeleteDocumentClick(hyperlink) {
        var IsDelete = $("#hdnDeleteDocument").val();
        if (IsDelete == "Y") {
            return SelectedRowDelete("#RadgvDocuments", 'file');
        } else {
            noty({ text: 'You do not have permission!', type: 'warning', layout: 'topCenter', closeOnSelfClick: true, timeout: 5000, theme: 'noty_theme_default', closable: false, dismissQueue: true });
            return false;
        }
    }

    function ViewDocumentClick(hyperlink) {
        var IsView = $("#hdnViewDocument").val();
        if (IsView == "Y") {
            return true;
        } else {
            noty({ text: 'You do not have permission!', type: 'warning', layout: 'topCenter', closeOnSelfClick: true, timeout: 5000, theme: 'noty_theme_default', closable: false, dismissQueue: true });
            return false;
        }
    }

    function RedirectToAddPoScreen(ticketid, comp) {
        var str = 'addpo.aspx?TicketId=' + ticketid + '&comp=' + comp + '&pop=1';
        if (str != null) {
            setTimeout(window.location.href = str, 3000);
        }
        //console.log(str);
    }
    function btnaddpoCClick() {
        var str = window.location.href;
        var s = str.search('id') > -1;
        //console.log(s);
        if (!s) {
            var r = confirm("Save Ticket Before Add PO!");
            if (r == true) {
                $("#hdnIsAddPO").val('1');
                $("#lnkSave").click();
                return false;
            } else {
                $("#hdnIsAddPO").val('0');
                return false;
            }
        }
        else { return true; }
    }

    function focusParent() {
        window.close();
    }

    function RefressTicketListContact() {
        if (window.opener && !window.opener.closed) {
            if (window.opener.$('ctl00_ContentPlaceHolder1_btnSearch'))
                window.opener.$('ctl00_ContentPlaceHolder1_btnSearch').click();
        }
        $("#btnRefressTicketScreen").click();

    }
    function checkedHidden(checkbox) {
        $(checkbox).closest('tr').find($("input[id*='hdnChecked']")).val("1");
    }

    function RefressTicketPage() {
        var r = confirm("Can't save the Ticket. The ticket has been already completed from Mobile Service. Click OK to refresh the screen and get the latest changes.");
        if (r == true) {
            var str = window.location.href.replace("comp=0", "comp=1");
            window.location.href = str;
        }
    }
</script>

<script type="text/javascript">
    /// Category IMG
    function CategoryImage() {
        var ddlCat = $("#ddlCategory");
        var cat = ddlCat.options[ddlCat.selectedIndex].val();
        $("#imgCategory").attr("src", 'imagehandler.ashx?catid=' + cat);
    }

    /////////////////////////////////////////////////////////////////////////////////////////
    ///////////////////////////////        Page load      ///////////////////////////////////
    /////////////////////////////////////////////////////////////////////////////////////////

    $(document).ready(function () {
        // multiple ticket
        $("#txtPhoneCust").mask("(999) 999-9999? Ext 99999");
        $("#txtCell").mask("(999) 999-9999");

        $('.sigPad').signaturePad();

        jQuery('.sign-title-l').click(function () {
            jQuery('#hdnDrawdata').val("");
        });

        ////When your form is submitted
        //$("form").submit(function (e) {
        //    //Display your loading icon
        //    if (Page_ClientValidate()) {
        //        $("#loading").show();
        //    }
        //});

        $("#NearWorkers").empty();
        //$("#NearWorkers").append("<th style='padding:4px 5px; text-align:center'>Nearest Workers <img src='images/refresh2.png' alt='refresh' title='Refresh' onclick='CallNearestWorker();' style='cursor:pointer; float:right' /></th>");

        var isTS = '<% Session["MSM"].ToString() %>';
        var isTSint = '<% ViewState["tsint"].ToString() %>';
        if (isTSint != "1") {
            if (isTS == 'TS') {
                // $("#ddlStatus").options[4].disabled = true;
                // $("#ddlStatus").options[4].onclick = function () { alert('Ticket can only be completed from Total Service.'); };
            }
        }

        ValidateChargeable();
        CheckIsProspect();
        calculateTotalTime();
        calculateMileage();

        ///////////////////////Ajax call for equipment search//////////////////////////////
        function dataEquip() {
            this.prefixText = null;
        }
        function dataEmpty() {
            this.d = "";
        }

        ///////////// Select text onclick handling ////////////////////
        //selectAll("#txtEnrTime");
        //selectAll("#txtOnsitetime");
        //selectAll("#txtComplTime");
        //selectAll("#txtRT");
        //selectAll("#txtOT");
        //selectAll("#txtNT");
        //selectAll("#txtDT");
        //selectAll("#txtTT");
        //selectAll("#txtBT");

        ///////////// Quick Codes //////////////
        $("#txtReason").change(function () { $("#hdnIsEdited").val('1'); });

        $("#txtReason").keyup(function (event) {
            replaceQuickCodes(event, "#txtReason", $("#hdnCon").val());
        });

        $("#txtWorkCompl").keyup(function (event) {
            replaceQuickCodes(event, "#txtWorkCompl", $("#hdnCon").val());
        });

        $("#txtRemarks").keyup(function (event) {
            replaceQuickCodes(event, "#txtRemarks", $("#hdnCon").val());
        });

        ////////////////////////////// Textbox resize ///////////////////


        $("#txtRecommendation").focus(function () {
            $(this).animate({
                width: '520px'
                , height: '+=150px'
            }, 500, function () {
                // Animation complete.
            });
        });

        $("#txtRecommendation").blur(function () {
            $(this).animate({
                width: '100%',
                height: '63px'
            }, 500, function () {
                // Animation complete.
            });
        });

        $("#txtPartsUsed").focus(function () {
            $(this).animate({
                width: '520px'
                , height: '+=150px'
            }, 500, function () {
                // Animation complete.
            });
        });

        $("#txtPartsUsed").blur(function () {
            $(this).animate({
                width: '100%',
                height: '63px'
            }, 500, function () {
                // Animation complete.
            });
        });

        $("#txtComments").focus(function () {
            $(this).animate({
                width: '520px'
                , height: '+=150px'
            }, 500, function () {
                // Animation complete.
            });
        });

        $("#txtComments").blur(function () {
            $(this).animate({
                width: '100%',
                height: '63px'
            }, 500, function () {
                // Animation complete.
            });
        });


        $("#txtWorkCompl").focus(function () {
            $(this).animate({
                width: '520px'
                , height: '+=150px'
            }, 500, function () {
                // Animation complete.
            });
        });

        $("#txtWorkCompl").blur(function () {
            $(this).animate({
                width: '100%'
                , height: '63px'
            }, 500, function () {
                // Animation complete.
            });
        });

        ///////////// Invoice ////////////////////////////////////
        //            $("#txtInvoiceNo").blur(function() {
        //                CheckIsInvoiced();
        //            });

        $("#chkInvoice").change(function () {
            ValidateChargeable();
        });


        var oImg = $("#imgSign");
        var ImgHdn = $("#hdnImg");
        oImg.src = ImgHdn.val();

        $("#txtGoogleAutoc").keyup(function (ev) {
            //                if (event.which != 27 && event.which != 37 && event.which != 38 && event.which != 39 && event.which != 40 && event.which != 13) {
            if ((e.which >= 46 && e.which <= 90) || (e.which >= 96 && e.which <= 105) || (e.which >= 186 && e.which <= 222) || e.which == 8) {
                var txtLat = $("# lat");
                var txtLng = $("# lng");
                txtLat.value = "";
                txtLng.value = "";
            }
        });

        //Time picker focus fuction
        $('input.timepicker').timepicker({
            dropdown: false
        });
        $('input.timepicker1').timepicker({
            dropdown: false
        });
        $('input.timepicker1').on('click', function () {
            if ($('input.timepicker1').val() == "") {
                $('input.timepicker1').timepicker('setTime', new Date());
                $(this).select();
            }
            else { $(this).select(); }
        });
        $('input.timepicker1').on('focus', function () {

            $(this).select();
        });
        $('input.timepicker').on('focus', function () {

            $(this).select();
        });

        $("#txtRemarks").animate({
            //right: "+=0",
            //width: '520px',
            height: '63px'
        }, 500, function () {
            // Animation complete.
        });

    });

    function isCanvasSupported() {
        var elem = document.createElement('canvas');
        return !!(elem.getContext && elem.getContext('2d'));
    }

    ///////////// Custom validator function for customer auto search  ////////////////////
    function ChkCustomer(sender, args) {
        var hdnPatientId = $("#hdnPatientId");
        if (hdnPatientId.val() == "") {
            args.IsValid = false;
        }
    }

    ///////////// Custom validator function for location auto search  ////////////////////
    function ChkLocation(sender, args) {
        var hdnLocId = $("#hdnLocId");
        if (hdnLocId.val() == "") {
            args.IsValid = false;
        }
    }

    function ace_itemSelected(sender, e) {

    }

    function cancel() {
        window.close();
    }

    ///////////////////////////////    Convert signature to image      ////////////////////////////////
    function toImage() {
        var hdnDrawdata = $("hdnDrawdata");
        var hdnImg = $("#hdnImg");
        var oImgElement = $("#imgSign");
        var canvas = $("canvas");
        if (hdnDrawdata.val() != "") {
            var img = canvas.toDataURL("image/png");
            oImgElement.src = img;
            hdnImg.val(img);
        }
    }

    ////////////////////////    Select all text in textbox on click     ////////////////////////////
    function selectAll(id) {
        var eraInput = $(id);
        $("#" + id).click(function () {
            //                setTimeout(function() {
            eraInput.setSelectionRange(0, 9999);
            //                }, 10);
        });
    }

    ////////////////////////    Calculate time difference between ER-OS-CT    ////////////////////////////
    function calculate_Time() {

        var txtER = $("#txtEnrTime").val();
        var txtOS = $("#txtOnsitetime").val();
        var txtCT = $("#txtComplTime").val();

        if (txtOS != "" && txtER != "" && txtOS != '__:__ AM' && txtOS != '__:__ PM' && txtER != '__:__ AM' && txtER != '__:__ PM') {
            var diff = Math.round(((new Date('01/01/2009 ' + txtOS) - new Date('01/01/2009 ' + txtER)) / 1000 / 60 / 60) * 100) / 100;
            if (diff < 0) { diff = diff + 24; }
            $("#txtTT").val(diff.toFixed(2));
        }
        else {
            $("#txtTT").val('0.00');
        }

        if (txtOS != "" && txtCT != "" && txtOS != '__:__ AM' && txtOS != '__:__ PM' && txtCT != '__:__ AM' && txtCT != '__:__ PM') {
            var diff = Math.round(((new Date('01/01/2009 ' + txtCT) - new Date('01/01/2009 ' + txtOS)) / 1000 / 60 / 60) * 100) / 100;
            if (diff < 0) { diff = diff + 24; }
            $("#txtRT").val(diff.toFixed(2));
        }
        else {
            $("#txtRT").val('0.00');
        }

        //For Break time Deduction  reset the values
        if ($("#txtBT").val() != "") {
            if (parseFloat($("#txtBT").val()) != 0) {
                $("#txtOT").val($("#HiddenFieldOT").val());
                $("#txtNT").val($("#HiddenFieldNT").val());
                $("#txtDT").val($("#HiddenFieldDT").val());
            }
        }

        $("#HiddenFieldRT").val($("#txtRT").val());
        $("#HiddenFieldTT").val($("#txtTT").val());

        calculateTotalTime();
        DeductedValue(false);
    }

    //////DeductedValue////////////
    function DeductedValue(TXTbtTextChange) {

        var DeductedValue = 0;
        var txtHdnBT = 0;
        if (TXTbtTextChange == true) {
            txtHdnBT = $("#HiddenFieldBT").val();
        }
        else {
            $("#HiddenFieldBT").val(0);
        }

        if (txtHdnBT == "") {
            txtHdnBT = '0.00';
        }

        if ($("#HiddenFieldBTFlag").val() == '1' || (parseFloat(txtHdnBT) > parseFloat(0))) {

            $("#txtRT").val($("#HiddenFieldRT").val());
            $("#txtOT").val($("#HiddenFieldOT").val());
            $("#txtNT").val($("#HiddenFieldNT").val());
            $("#txtDT").val($("#HiddenFieldDT").val());
            $("#txtTT").val($("#HiddenFieldTT").val());
        }
        var txtRT = $("#txtRT").val();
        var txtOT = $("#txtOT").val();
        var txtNT = $("#txtNT").val();
        var txtDT = $("#txtDT").val();
        var txtTT = $("#txtTT").val();

        calculateTotalTime();

        var txtBT = $("#txtBT").val();

        var txtTotal = $("#txtTotal").val();


        if (txtBT == "") {
            txtBT = '0.00';
        }

        if (txtTotal == "") {
            txtTotal = '0.00';
        }
        if ((parseFloat(txtHdnBT) > parseFloat(0))) {
            txtBT = (parseFloat(txtBT) - parseFloat(txtHdnBT));
        }
        //|| (parseFloat(txtBT) < parseFloat(0))
        if ((parseFloat(txtBT) > parseFloat(txtTotal))) {
            if (TXTbtTextChange == true) {
                if ((parseFloat(txtBT) > parseFloat(txtTotal))) {

                    noty({ text: "Break Time must be less than Total time", dismissQueue: true, type: 'warning', layout: 'topCenter', closeOnSelfClick: true, timeout: false, theme: 'noty_theme_default', closable: false });
                    $("#txtBT").val(0);
                }
            }
        }

        // && (parseFloat(txtBT) > parseFloat(0))
        if ((parseFloat(txtBT) <= parseFloat(txtTotal))) {

            DeductedValue = parseFloat(txtBT);

            if (txtRT == "") {
                txtRT = '0.00';
            }
            if (txtOT == "") {
                txtOT = '0.00';
            }
            if (txtNT == "") {
                txtNT = '0.00';
            }
            if (txtDT == "") {
                txtDT = '0.00';
            }
            if (txtTT == "") {
                txtTT = '0.00';
            }

            if (txtBT == "") {
                txtBT = '0.00';
            }

            //  rt > tt > ot > dt>  > nt

            if (parseFloat(DeductedValue) < parseFloat(txtRT)) {

                txtRT = (parseFloat(txtRT) - parseFloat(DeductedValue));
                DeductedValue = 0
            }
            else {
                DeductedValue = (parseFloat(DeductedValue) - parseFloat(txtRT));
                txtRT = 0;
            }


            if (parseFloat(DeductedValue) < parseFloat(txtTT)) {

                txtTT = (parseFloat(txtTT) - parseFloat(DeductedValue));
                DeductedValue = 0
            }
            else {
                DeductedValue = (parseFloat(DeductedValue) - parseFloat(txtTT));
                txtTT = 0;
            }

            if (parseFloat(DeductedValue) < parseFloat(txtOT)) {

                txtOT = (parseFloat(txtOT) - parseFloat(DeductedValue));
                DeductedValue = 0
            }
            else {
                DeductedValue = (parseFloat(DeductedValue) - parseFloat(txtOT));
                txtOT = 0;
            }

            if (parseFloat(DeductedValue) < parseFloat(txtDT)) {

                txtDT = (parseFloat(txtDT) - parseFloat(DeductedValue));
                DeductedValue = 0
            }
            else {
                DeductedValue = (parseFloat(DeductedValue) - parseFloat(txtDT));
                txtDT = 0;
            }

            if (parseFloat(DeductedValue) < parseFloat(txtNT)) {

                txtNT = (parseFloat(txtNT) - parseFloat(DeductedValue));
                DeductedValue = 0
            }
            else {
                DeductedValue = (parseFloat(DeductedValue) - parseFloat(txtNT));
                txtNT = 0;
            }

            $("#txtRT").val(txtRT);
            $("#txtOT").val(txtOT);
            $("#txtNT").val(txtNT);
            $("#txtDT").val(txtDT);
            $("#txtTT").val(txtTT);
            $("#HiddenFieldBTFlag").val(1);
        }
        calculateTotalTime();
    }

    ////////////////////////    Calculate total time    ////////////////////////////
    function calculateTotalTime() {
        var txtRT = $("#txtRT").val();
        var txtOT = $("#txtOT").val();
        var txtNT = $("#txtNT").val();
        var txtDT = $("#txtDT").val();
        var txtTT = $("#txtTT").val();


        if (txtRT == "") {
            txtRT = '0.00';
        }
        if (txtOT == "") {
            txtOT = '0.00';
        }
        if (txtNT == "") {
            txtNT = '0.00';
        }
        if (txtDT == "") {
            txtDT = '0.00';
        }
        if (txtTT == "") {
            txtTT = '0.00';
        }

        var total = Math.round((parseFloat(txtRT) + parseFloat(txtOT) + parseFloat(txtNT) + parseFloat(txtDT) + parseFloat(txtTT)) * 100) / 100;

        $("#txtTotal").val(total.toFixed(2));
        $("#lblTotal").text(total.toFixed(2));

    }

    ////////////////////  Check Translation ///////////////////
    function checkTranslation() {

        ToggleValidator();

        if (Page_ClientValidate()) {
            debugger
            var charge = ValidateChargeable();
            if (charge == false) {
                return false;
            }

            var prospect = NewProspectAlert();
            if (prospect == false) {
                return false;
            }

            var hdnMultiLang = $("#hdnMultiLang").val();
            var hdnLang = $("#hdnLang").val();
            var hdnIsEdited = $("#hdnIsEdited").val();

            if (hdnLang != 'english' && hdnIsEdited == '1' && hdnMultiLang == '1') {

                var r = confirm('The reason for service text has been changed but not translated to Spanish/English. Click OK to open the translation box else cancel to continue save the ticket.');
                if (r == true) {
                    $("#txtReason").focus();
                    return false;
                }
                else {
                    return true;
                }
            }
        }
    }

    ////////////////////  Check Follow-up ticket ///////////////////
    function CheckWorkComplete(ticid, checked, msg, comp, invoice) {

        //            var checked = $("#chkWorkComp").is(':checked');
        if (checked == 0) {
            var r = confirm('Would you like to create a follow-up ticket at this time?');
            if (r == true) {
                window.location.href = "addticket.aspx?copy=1&follow=1&id=" + ticid + "&comp=" + comp;
            }
            else {
                noty({ text: msg, dismissQueue: true, type: 'success', layout: 'topCenter', closeOnSelfClick: true, timeout: false, theme: 'noty_theme_default', closable: false });
            }
        }
        else {
            noty({ text: msg, dismissQueue: true, type: 'success', layout: 'topCenter', closeOnSelfClick: true, timeout: false, theme: 'noty_theme_default', closable: false });
        }
        if (invoice == 1) {
            {
                $("#lnkProcessInvoicing").click();
            }
        }
    }

    /////////////////// Calculate Traveled Mileage //////////////////
    function calculateMileage() {
        var txtSM = $("#txtMileStart").val();
        var txtEM = $("#txtMileEnd").val();

        if (txtSM == "") {
            txtSM = '0.00';
        }
        if (txtEM == "") {
            txtEM = '0.00';
        }

        var total = parseInt(txtEM) - parseInt(txtSM);

        $("#txtMileTraveled").text(total);

        ////////Expenses
        var txtExpMisc = $("#txtExpMisc").val();
        var txtExpToll = $("#txtExpToll").val();
        var txtExpZone = $("#txtExpZone").val();

        if (txtExpMisc == "") {
            txtExpMisc = '0.00';
        }
        if (txtExpToll == "") {
            txtExpToll = '0.00';
        }
        if (txtExpZone == "") {
            txtExpZone = '0.00';
        }

        var Expensestotal = parseFloat(txtExpMisc) + parseFloat(txtExpToll) + parseFloat(txtExpZone);

        $("#lblTotalExp").text(Expensestotal);
    }

    ////////////////// Confirm Document Upload ////////////////////
    function ConfirmUpload(value) {
        var filename;
        var fullPath = value;
        if (fullPath) {
            var startIndex = (fullPath.indexOf('\\') >= 0 ? fullPath.lastIndexOf('\\') : fullPath.lastIndexOf('/'));
            filename = fullPath.substring(startIndex);
            if (filename.indexOf('\\') === 0 || filename.indexOf('/') === 0) {
                filename = filename.substring(1);
            }
        }

        if (confirm('Upload ' + filename + '?')) { $("#lnkUploadDoc").click(); }
        else { $("#lnkPostback").click(); }
    }

    //////////////// Confirm Mail Send to worker ///////////////////
    function notyConfirm(ticid, Navigation) {

        if (Navigation == 'job') {

            if (window.opener && !window.opener.closed) {
                if (window.opener.$("#lnkjobticketSearch")) {
                    window.opener.$("#lnkjobticketSearch").click();
                }
            }
            window.close();
        }
        if (Navigation == 'none') {
            noty({
                dismissQueue: true,
                layout: 'topCenter',
                theme: 'noty_theme_default',
                animateOpen: { height: 'toggle' },
                animateClose: { height: 'toggle' },
                easing: 'swing',
                text: 'Do you want to send a text message to the assigned worker at this time?',
                type: 'alert',
                speed: 500,
                timeout: false,
                closeButton: false,
                closeOnSelfClick: true,
                closeOnSelfOver: false,
                force: false,
                onShow: false,
                onShown: false,
                onClose: false,
                onClosed: false,
                buttons: [
                    {
                        type: 'btn-primary', text: 'Yes', click: function ($noty) {
                            $noty.close();
                            window.open("mailticket.aspx?id=" + ticid + "&c=0", "_blank");
                        }
                    },
                    {
                        type: 'btn-danger', text: 'No', click: function ($noty) {
                            $noty.close();
                            window.open("addticket.aspx?id=" + ticid + "&comp=0&pop=1&fr=tlv", "_self");
                        }
                    }
                ],
                modal: true,
                template: '<div class="noty_message"><span class="noty_text"></span><div class="noty_close"></div></div>',
                cssPrefix: 'noty_',
                custom:
                {
                    container: null
                }
            });
        }
    }

    ////////////////// Called when save form and validation caused on tab 1 //////////////
    function tabchng() {


    }

    function ValidateTime(sender, args) {
        var start = $("#txtEnrTime").val();
        var end = $("#txtOnsitetime").val();

        var fromdt = "2010/01/01 " + start;
        var todt = "2010/01/01 " + end;

        var from = new Date(Date.parse(fromdt));
        var to = new Date(Date.parse(todt));

        if (from > to) {
            args.IsValid = false;
        } else {
            args.IsValid = true;
        }
    }

    function ValidateTimeComplete(sender, args) {
        var start = $("#txtOnsitetime").val();
        var end = $("#txtComplTime").val();

        var fromdt = "2010/01/01 " + start;
        var todt = "2010/01/01 " + end;

        var from = new Date(Date.parse(fromdt));
        var to = new Date(Date.parse(todt));

        if (from > to) {
            args.IsValid = false;
        } else {
            args.IsValid = true;
        }
    }

    function ValidateChargeable() {
        var chkChargeable = $("#chkChargeable");
        var chkInvoice = $("#chkInvoice");
        var txtInvoiceID = $("#txtInvoiceNo");

        if (chkInvoice.is(':checked') == true) {

            if (chkChargeable.is(':checked') == false) {
                noty({
                    text: 'Ticket must be chargeable to generate invoice.',
                    type: 'warning',
                    layout: 'topCenter',
                    closeOnSelfClick: false,
                    timeout: 5000,
                    theme: 'noty_theme_default',
                    closable: true
                });
                chkInvoice.css('checked', false);
                return false;
            }
            else {
                return true;
            }
        }
        else {
            return true;
        }
    }

    function CheckIsProspect() {
        var hdnPatientId = $("#hdnPatientId");
        var txtLoc = $("#txtLocation");
        var txtCust = $("#txtCustomer");
        var hdnProspect = $("#hdnProspect");
        if (hdnPatientId.val() == "" && txtCust.val() != "") {
            txtLoc.css('disabled', true);
            txtLoc.val("");
            hdnProspect.val("1");
            txtCust.css('color', 'brown');
            ValidatorEnable($("#RequiredFieldValidator1"), false);
            //$("#btnValidateLocation").click();
            $("#txtAcctno").val("--");
        }
        else {
            hdnProspect.val("");
        }
    }

    function NewProspectAlert() {
        var hdnPatientId = $("#hdnPatientId");
        var txtLoc = $("#txtLocation");
        var txtCust = $("#txtCustomer");
        var hdnLocID = $("#hdnLocId");
        var lblalertprospect = $("#lblAlertProspect");
        if (hdnPatientId.val() == "" && txtCust.val() != "" && hdnLocID.val() == "") {
            var r = confirm('You have not selected an existing Customer/Lead. The entered Customer name will be considered as a new Lead. Click OK to continue creating a new Lead or click on Cancel to select an existing Customer/Lead.');
            return r;
        }
    }

    function CheckIsInvoiced() {
        var txtInvoiceID = $("#txtInvoiceNo");
        var chkInvoice = $("#chkInvoice");
        var chkCharge = $("#chkChargeable");

        if (txtInvoiceID.val() != "") {
            chkInvoice.css('checked', false);
        }
    }

    function CallNearestWorker() {
        var txtlat = $("#lat");
        var txtlng = $("#lng");

        if (txtlat.value == "") {

            var mainaddress = $("#txtGoogleAutoc").val();
            var city = $("#txtCity").val();
            var state = $("#ddlState").val();
            var zip = $("#txtZip").val();
            var address = mainaddress + ', ' + city + ', ' + state + ', ' + zip;

            if (mainaddress != "") {
                $("#wait").show();
                codeAddress(address, function (latlng) {
                    txtlat.val(latlng.lat());
                    txtlng.val(latlng.lng());
                    InitMap(latlng.lat(), latlng.lng());
                    CallNearestWorkerList(latlng.lat(), latlng.lng());
                });
            }
        }
        else {
            $("#wait").show();
            CallNearestWorkerList(txtlat.val(), txtlng.val());
        }
    }

    function CallNearestWorkerList(lat, lng) {
        var worker = "";
        if (lat != "") {
            if (lng != "") {
                function NearWorkerData() {
                    this.lat = null;
                    this.lng = null;
                    this.worker = null;
                    // this.ISDefaultWorker = null;
                }

                var objNearWorkerData = new NearWorkerData();
                objNearWorkerData.lat = lat;
                objNearWorkerData.lng = lng;
                objNearWorkerData.worker = worker;
                // objNearWorkerData.ISDefaultWorker = 0;

                $.ajax({
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: "NearWorker.asmx/GetNearWorker",
                    data: JSON.stringify(objNearWorkerData),
                    dataType: "json",
                    async: true,
                    success: function (data) {
                        drawTable($.parseJSON(data.d), worker);
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        //var err = eval("(" + XMLHttpRequest.responseText + ")");
                        //alert(err.Message);
                    }
                }).done(CallDefaultworker);
            }
        }
    }

    function CallDefaultworker() {
        var ddlDefRoute = $("#ddlDefRoute");
        var worker = ddlDefRoute.options[ddlDefRoute.selectedIndex].text
        var lat = $("#lat").val();
        var lng = $("#lng").val();
        if (lat != "") {
            if (lng != "") {
                function NearWorkerData() {
                    this.lat = null;
                    this.lng = null;
                    this.worker = null;
                    //this.ISDefaultWorker = null;
                }

                var objNearWorkerData = new NearWorkerData();
                objNearWorkerData.lat = lat;
                objNearWorkerData.lng = lng;
                objNearWorkerData.worker = worker;
                //objNearWorkerData.ISDefaultWorker = 1;
                $.ajax({
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: "NearWorker.asmx/GetNearWorker",
                    data: JSON.stringify(objNearWorkerData),
                    dataType: "json",
                    async: true,
                    success: function (data) {
                        drawTable($.parseJSON(data.d), worker);
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        //var err = eval("(" + XMLHttpRequest.responseText + ")");
                        //alert(err.Message);
                    }
                });
            }
        }
        $("#wait").hide();
    }

    function drawTable(data, worker) {
        if (worker == "") {
            $("#NearWorkers").empty();
            //$("#NearWorkers").append("<th>Nearest Workers <img src='images/refresh2.png' alt='refresh' title='Refresh' onclick='CallNearestWorker();' style='cursor:pointer; float:right' /></th>");
            for (var i = 0; i < data.length; i++) {
                drawRow(data[i]);
            }
        }
        else {
            for (var i = 0; i < data.length; i++) {
                drawRowDefault(data[i]);
            }
        }
    }

    function drawRow(rowData) {
        //if (rowData.latitude != "" && rowData.longitude != "") {
        if (rowData.GPS == 1) {
            getGeoAddress(rowData.latitude, rowData.longitude, function (addr) {
                createrow(rowData, addr);
            });
        }
        else {
            createrow(rowData, rowData.address);
        }
    }

    function createrow(rowData, addr) {
        var row = $("<tr/>")
        $("#NearWorkers").append(row);

        var strrow = "<td><hr/>";
        strrow += "<div class='nearest-head'>";
        strrow += " <span class='worker-name'><b>" + rowData.worker + " </b></span>";
        strrow += " <span class='nearest-time'>" + rowData.Time + "</span>";
        strrow += " </div>";
        strrow += " <div class='nearest-address'>";
        if (addr != "") {
            strrow += " <span>" + addr + " </span>";
        }
        strrow += " <span style='float: right' class='distance'>" + rowData.dist + " miles";
        strrow += "  </span>";
        strrow += " </div> ";
        strrow += "</td>";
        row.append($(strrow));

    }

    function drawRowDefault(rowData) {
        //if (rowData.latitude != "" && rowData.longitude != "") {
        if (rowData.GPS == 1) {
            getGeoAddress(rowData.latitude, rowData.longitude, function (addr) {
                CreateRowDefault(rowData, addr);
            });
        }
        else {
            CreateRowDefault(rowData, rowData.address);
        }
    }

    function CreateRowDefault(rowData, addr) {
        var row = $("<tr/>")
        row.prependTo("#NearWorkers > tbody");

        var strrow = "<td style='background-color:yellow;'><hr/>";
        strrow += "<div class='nearest-head'>";
        strrow += " <span class='worker-name'><b>" + rowData.worker + " </b></span>";
        strrow += " <span class='nearest-time'>" + rowData.Time + " </span>";
        strrow += " </div>";
        strrow += " <div class='nearest-address'>";
        if (addr != "") {
            strrow += " <span>" + addr + " </span>";
        }
        strrow += " <span style='float: right' class='distance'>" + rowData.dis + " miles";
        strrow += "  </span>";
        strrow += " </div> ";
        strrow += "</td>";
        row.append($(strrow));
    }

    function getGeoAddress(lat, lng, callback) {
        var latlng = new google.maps.LatLng(lat, lng);
        var geocoder = new google.maps.Geocoder();
        geocoder.geocode({ 'latLng': latlng }, function (results, status) {
            if (status == google.maps.GeocoderStatus.OK) {
                if (results[1]) {
                    callback(results[1].formatted_address);
                }
            }
            else {
                callback("");
            }
        });
    }

    function codeAddress(address, callback) {
        var success = 0;
        var geocoder = new google.maps.Geocoder();
        geocoder.geocode({ 'address': address }, function (results, status) {
            if (status == google.maps.GeocoderStatus.OK) {
                if (results[0].geometry.location_type == 'ROOFTOP') {
                    callback(results[0].geometry.location);
                    success = 1;
                }
            }
        });

    }
    $(":file").filestyle({
        buttonName: "btn-primary",
    });

    function ToggleValidator() {
        var chk = false;

    }

    function checkMaxLength(textarea, evt, maxLength) {
        if ($("#hdnSageInt").val() == "1") {
            var lines = textarea.value.split("\n");
            for (var i = 0; i < lines.length; i++) {
                if (lines[i].length <= 30) continue;
                var j = 0; space = 30;
                while (j++ <= 30) {
                    if (lines[i].charAt(j) === " ") space = j;
                }
                lines[i + 1] = lines[i].substring(space + 1) + (lines[i + 1] || "");
                lines[i] = lines[i].substring(0, space);
            }
            textarea.value = lines.slice(0, 2).join("\n");
            $("#spnAddress").fadeIn('slow', function () {
                $(this).delay(500).fadeOut('slow');
            });
        }
    }

    function OpenWOreport() {
        if ($("#txtWO").val() != "" && $("#hdnLocId").val() != "")//&& $("# chkReviewed").is(':checked') == true && $("#chkInternet").is(':checked') == true
        {
            window.open("printwo.aspx?wo=" + $("#txtWO").val() + "&lid=" + $("#hdnLocId").val(), '_blank');
        }
    }

    function NewProject() {
        $("#hdnProjectId").val("");
        $("#txtProject").val("--New Project--");
        $("#projectNo").val("--New Project--");
        $("#ddlTemplate").prop('disabled', false);
        $("#lnkProjectID").removeAttr("href");
        $("#txtJobCode").val("");
    }
</script>
<script type="text/javascript">
    function ProcessInvoicing() {
        var chkChargeable = $("#chkChargeable");

        if (chkChargeable.checked == true) {
            return true;
        } else {
            noty({
                text: 'Ticket must be chargeable to generate invoice.',
                type: 'warning',
                layout: 'topCenter',
                closeOnSelfClick: false,
                timeout: 5000,
                theme: 'noty_theme_default',
                closable: true
            });
            return false;
        }
    }

    function ProcessInvoicingnext() {
        debugger;
        var Workorderonly = 0, Project = 0, Reviewonly = 0, Combind = 0;

        if ($('#rdTicket').is(':checked')) {
            Workorderonly = 0, Project = 0, Combind = 0;
        }
        else {

            if ($('#rdWorkorderonly').is(':checked')) {
                Workorderonly = 1;
            }

            if ($('#rdProject').is(':checked')) {
                Project = 1;
            }

            if ($("#Combind").is(':checked')) {
                Combind = 1;
            }
        }
        if ($("#Reviewonly").is(':checked')) {
            Reviewonly = 1;
        }

        var tickid = '<%= Request.QueryString["id"] %>'

        window.open('addinvoice.aspx?o=1&Reviewonly=' + Reviewonly + '&Project=' + Project + '&Workorderonly=' + Workorderonly + '&Combind=' + Combind + '&tickid=' + tickid, 'Invoice', 'height = 768, width = 1300, scrollbars = yes,toolbar=no,menubar=no,location=no');
        return false;
    }
</script>

@Html.Hidden("hdnIsJobChargable", "0")
@Html.Hidden("hdnIsCatChargable", "0")

@*<%-------$$$$$$$$$$$$$$$ HEADER SETION  $$$$$$$$$$$$$$$-----%>*@



<div class="divbutton-container">
    <div id="divButtons" class="">
        <div id="breadcrumbs-wrapper">
            <header>
                <div class="container row-color-grey">
                    <div class="row">
                        <div class="row">

                            <div class="col s12 m12 l12">
                                <div class="page-title"><i class="mdi-action-trending-up"></i>&nbsp;<label class="title_text" ID="lblHeader" style="font-size:14px">Add Ticket</label></div>
                                <div class="buttonContainer">
                                    <div class="btnlinks">
                                        <a ID="lnkSave" ToolTip="Save Ticket" ValidationGroup="addticketVG" CausesValidation="true" onclick="return SaveTicket(this);">Save</a>
                                    </div>

                                    <div class="btnlinks">
                                        <a ID="lnkCopy" ToolTip="Copy Ticket" CausesValidation="false">Copy</a>
                                    </div>

                                    <div class="btnlinks">
                                        <a ID="lnkProcessInvoicing" ToolTip="Invoice" class="lnkProcessInvoicingCss" CausesValidation="false"
                                           onclick="return ProcessInvoicing();">Invoice</a>
                                    </div>

                                    <div class="btnlinks">
                                        <a class="dropdown-button" data-beloworigin="true" data-activates="dynamicUI" ID="lnkPrint" CausesValidation="false"
                                            ToolTip="Report">
                                            Report
                                        </a>
                                    </div>

                                    <ul id="dynamicUI" class="dropdown-content">
                                        <asp:Literal ID="dynamicUIPlaceholder" />
                                    </ul>

                                    <div class="btnlinks">
                                        <a ID="lnkPDF" CausesValidation="false"
                                            ToolTip="Print Ticket">
                                            PDF
                                        </a>
                                    </div>
                                </div>

                                <div class="btnclosewrap">
                                    <a ID="lnkClose" ToolTip="Close" CausesValidation="false"><i class="mdi-content-clear"></i></a>
                                </div>
                                <div class="btnclosewrap-one">
                                    <a class="collapse-expand opened" data-position="bottom" data-tooltip="Expand/Collapse Accordion">
                                        <i class="mdi-action-open-in-browser"></i>
                                    </a>
                                </div>
                                <div class="rght-content">
                                    <div class="editlabel">
                                        @*<telerik:RadAjaxPanel ID="RadAjaxPanelHeader"  >*@
                                        <ul class="anchor-links" style="display: inline-block;">

                                            <li id="liTicket">
                                                <label ID="lblTicketHeader"></label>
                                            </li>
                                            <li>
                                                <label ID="lblAVCHeader"></label>
                                            </li>
                                            <li>
                                                <label ID="lblLocHeader"></label>
                                            </li>
                                            <li>
                                                <div class="tooltipped" id="Statustooltipped" style="background-color: whitesmoke; border-radius: 100px; height: 20px; width: 20px; margin-top: 7px;" data-position="left" data-tooltip="Un-Assigned"></div>
                                            </li>
                                        </ul>
                                        @*</telerik:RadAjaxPanel>*@
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
                <a class="icon-closed" id="lnkCancelContact" title="Close" onclick="focusParent()"></a>
                <a id="lnkRefressTicketList" style="display: block;" onclick="RefressTicketListContact()"></a>
                <input type="button" ID="btnMail" value="Email" Style="display: block;" CausesValidation="False" />
                <a ID="btnRefressTicketScreen" Style="display: block;" CausesValidation="false"></a>


            </header>
        </div>

        <div class="container breadcrumbs-bg-custom">
            <div class="row">
                <div class="col s12 m12 l12">
                    <div class="row">
                        <div class="tblnks">
                            <ul class="anchor-links">
                                <li style="width: 90px; text-align: center;"><a class="add-btn-click">Show Stats</a> </li>
                                <li><a href="#accrdticketInfo" class="link-slide">Ticket Info.</a></li>
                                <li><a href="#accrdcompleted" class="link-slide">Completed</a></li>
                                <li><a href="#accrdcustom" class="link-slide">Custom</a></li>
                                <li><a href="#accrdResolution" class="link-slide" onclick="LoadaccrdResolutiontab();">Resolution</a></li>
                                <li><a href="#accrdMCP" class="link-slide" onclick="LoadaccrdMCPtab();">MCP</a></li>
                                <li><a href="#accrdPO" class="link-slide" onclick="LoadaccrdPOtab();">PO</a></li>
                                <li><a href="#accrddocuments" class="link-slide">Documents</a></li>
                                <li><a href="#accrdInventory" class="link-slide" onclick="LoadaccrdInventorytab();">Inventory Used</a></li>
                                <li id="liLogs"><a href="#accrdlogs" onclick="LoadGvlog();">Logs</a></li>
                            </ul>
                        </div>
                        <div class="tblnksright">
                            <div class="nextprev" style="display: inline-block;">

                                <div ID="pnlNext">

                                    <span class="angleicons">
                                        <a ID="lnkFirst" ToolTip="First" CausesValidation="False">
                                            <i class="fa fa-angle-double-left"></i>
                                        </a>
                                    </span>
                                    <span class="angleicons">
                                        <a ID="lnkPrevious" ToolTip="Previous" CausesValidation="False">
                                            <i class="fa fa-angle-left"></i>
                                        </a>
                                    </span>
                                    <span class="angleicons">
                                        <a ID="lnkNext" ToolTip="Next" CausesValidation="False">
                                            <i class="fa fa-angle-right"></i>
                                        </a>
                                    </span>
                                    <span class="angleicons">
                                        <a ID="lnkLast" ToolTip="Last" class="icon-last" CausesValidation="False">
                                            <i class="fa fa-angle-double-right"></i>
                                        </a>
                                    </span>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>


            </div>

            <div id="stats" style="background-color: #fff !important;">
                <div id="addinfo" class="form-section-row" style="background-color: #fff; padding: 10px !important; box-shadow: 0 2px 2px 2px #ccc !important;">

                    @*<telerik:RadAjaxPanel ID="RadAjaxPanelstats">*@
                    <div class="form-section3">
                        <div class="input-field col s12">
                            <div>
                                <div id="Coord" style="display: block; background-color: #E5E3DF; border: 1px solid; display: block">
                                    <input id="lat" type="text" onfocus="this.blur();" />
                                    <input id="lng" type="text" onfocus="this.blur();" />
                                    <input id="locality" disabled="disabled" style="display: block;" />
                                    <input id="country" disabled="disabled" style="display: block;" />
                                </div>
                                <div id="map" style="border: 0; width: 100%; height: 250px;">
                                </div>

                            </div>

                        </div>

                    </div>
                    <div class="form-section3-blank">
                        &nbsp;
                    </div>
                    <div class="form-section1">
                        <div class="section-ttle">
                            Nearest Workers
                            <img src="~/MOMUI/Design/images/refresh2.png" alt="refresh" title="Refresh" onclick="CallNearestWorker();" style="cursor: pointer; float: right" />

                            <div id="wait" style="display: block">
                                <div>
                                    <img src="~/MOMUI/images/wheel.gif" />
                                </div>
                                <span>
                                    Loading
                                    Nearest Workers...
                                </span>
                            </div>

                        </div>
                        <div class="nearest-wrap">
                            <table id="NearWorkers" class="roundCorner" style="margin: 5px 0px 0px 0; border-radius: 5px; border: 1px solid #000; width: 100%">
                            </table>
                        </div>
                    </div>
                    <div class="form-section3-blank">
                        &nbsp;
                    </div>
                    @*</telerik:RadAjaxPanel>*@
                    <div class="form-section1">
                        <div class="section-ttle">
                            Recent Calls
                            <span style="float: right;">
                                <label style="height: 20px !important; font-size: 0.8em !important;">(Click on ticket too see more info.)</label>
                            </span>
                        </div>
                        <div class="nearest-worker-wrapper">

                            <div class="nearest-worker ps-container ps-active-y" style="margin-top: -17px !important;">
                                <div class="ticket-wrap">



                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-section3-blank">
                        &nbsp;
                    </div>

                    <div class="form-section1">
                        <div class="section-ttle">Stats</div>
                        <div class="nearest-wrap">
                            <div class="nearest-head">
                                <span class="worker-name"><b>Contract Type:</b></span>
                                <span class="nearest-time">Personal</span>
                            </div>
                        </div>
                        <div class="nearest-wrap">
                            <div class="nearest-head">
                                <span class="worker-name"><b># of Calls on Avg:</b></span>
                                <span class="nearest-time">45</span>
                            </div>
                        </div>
                        <div class="nearest-wrap">
                            <div class="nearest-head">
                                <span class="worker-name"><b>Random Info #1</b></span>
                                <span class="nearest-time">Random</span>
                            </div>
                        </div>
                        <div class="nearest-wrap">
                            <div class="nearest-head">
                                <span class="worker-name"><b>Random Info #2</b></span>
                                <span class="nearest-time">Random</span>
                            </div>
                        </div>
                        <div class="nearest-wrap">
                            <div class="nearest-head">
                                <span class="worker-name"><b>Random Info #3</b></span>
                                <span class="nearest-time">Random</span>
                            </div>
                        </div>
                        <div class="nearest-wrap">
                            <div class="nearest-head">
                                <span class="worker-name"><b>Random Info #4</b></span>
                                <span class="nearest-time">Random</span>
                            </div>
                        </div>
                    </div>
                    <div class="form-section3-blank">
                        &nbsp;
                    </div>


                </div>
            </div>

        </div>

    </div>
</div>

@*<%-------$$$$$$$$$$$$$$$ ACCORDIAN  $$$$$$$$$$$$$$$-----%>*@

<div class="container accordian-wrap">
    <div class="row">
        <div class="col s12 m12 l12">
            <div class="row">
                <ul class="collapsible popout collapsible-accordion form-accordion-head" data-collapsible="expandable">
                    <li class="active">

                        <div id="accrdticketInfo" class="collapsible-header accrd active accordian-text-custom "><i class="mdi-image-filter-frames"></i>Ticket Info.</div>

                        <div class="collapsible-body" style="display: block;">
                            <div class="form-content-wrap">
                                @*<telerik:RadAjaxPanel ID="RadAjaxPanelTicketInfo">*@
                                <div class="form-content-pd">

                                    <div class="form-section-row">
                                        <div class="form-section3">
                                            <div class="input-field col s5">
                                                <div class="row">
                                                    <label for="lblTicketnumber">Ticket # </label>
                                                    <input type="text" ID="lblTicketnumber" />
                                                </div>
                                            </div>
                                            <div class="input-field col s2">
                                                <div class="row">
                                                    &nbsp;
                                                    <img ID="imgHigh" style="width:25px; display:none" ToolTip="Declined"
                                                         src="~/MOMUI/Design/images/exclamation.png" />
                                                </div>
                                            </div>
                                            <div class="input-field col s5">
                                                <div class="row">
                                                    <input type="text" ID="txtWO" MaxLength="10"
                                                           TabIndex="1" />
                                                    <label for="txtWO"><a href="#" onclick="OpenWOreport();" style="color: #1565C0; margin-left: -15px;">WO #</a></label>

                                                    @Html.Hidden("hdnWO")

                                                </div>
                                            </div>

                                            <div class="srchclr btnlinksicon rowbtn">
                                                <a ID="lblRelatedTickets" ToolTip="Related Tickets"
                                                   CausesValidation="False" onclick="lblRelatedTickets_Client();">  <i class="mdi-maps-local-attraction" style="margin-left:0px !important;"></i></a>
                                            </div>
                                        </div>
                                        <div class="form-section3-blank">
                                            &nbsp;
                                        </div>
                                        <div class="form-section3">
                                            <div class="input-field col s9">

                                                <input type="text" TabIndex="2" ID="txtProject" autocomplete="off" />
                                                <label for="txtProject">Project</label>
                                                <div id="DivProject" class="popup_div " style="width: 500px; z-index: 2">

                                                    <div class="btnlinks" style="margin-bottom: 5px; float: left;">
                                                        <a onclick="NewProject();" CausesValidation="false" ID="addnewproject">Add New </a>

                                                    </div>

                                                    <div class="btnlinks" style="margin-bottom: 5px; float: right;">
                                                        <a CausesValidation="false" ID="HideMELinkButton3" onclick="HideME();">Close</a>
                                                    </div>
                                                    <div class="grid_container">
                                                        <div class="RadGrid RadGrid_Material FormGrid">

                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="srchclr btnlinksicon rowbtn">

                                                    <a ID="lnkProjectID" ><i class="mdi-action-work" style="margin-left:0px !important;"></i> </a>

                                                </div>

                                            </div>
                                            <div class="input-field col s3">
                                                <div class="checkrow">
                                                    <span class="css-checkbox">
                                                        <input type="checkbox" ID="chkJobChargeable" onclick="JobChargeableCheck()" />
                                                    </span>
                                                    <label for="chkJobChargeable">Chargeable</label>
                                                </div>
                                            </div>

                                        </div>
                                        <div class="form-section3-blank">
                                            &nbsp;
                                        </div>
                                        <div class="form-section3">

                                            <div class="input-field col s4">
                                                <div class="row">
                                                    <input type="text" ID="txtInvoiceNo" MaxLength="12"
                                                           TabIndex="4" disabled />
                                                    <label for="txtInvoiceNo">Invoice Number</label>
                                                </div>
                                            </div>
                                            <div class="input-field col s2">
                                                <div class="row">
                                                    &nbsp;
                                                    <a id="lnkInvoice" title="Invoice"
                                                       style="cursor: pointer;">
                                                        <img ID="imgInv" Style="height: 20px; margin: 1px 1px 1px 1px; display:none" ToolTip="Invoice" />

                                                    </a>
                                                </div>
                                            </div>
                                            <div class="input-field col s4">
                                                <div class="row">
                                                    <input type="text" ID="txtopp" MaxLength="12"
                                                           TabIndex="4" disabled />
                                                    <label for="txtInvoiceNo">Opportunity #</label>

                                                </div>
                                            </div>
                                            <div class="input-field col s2">
                                                <div class="row">
                                                    <a ID="lnkOpport">
                                                        <img ID="Image1" Style="height: 25px; margin: 1px 2px 0px 5px; display:none"
                                                             ToolTip="Opportunity" src="~/MOMUI/Design/images/thumb_up.png" />
                                                    </a>

                                                </div>
                                            </div>

                                        </div>

                                    </div>

                                    <div class="form-section-row">
                                        <div class="form-section3">
                                            <div class="section-ttle">Search Fields</div>
                                            <div class="input-field col s12">
                                                <div class="row">
                                                    <label for="txtCustomer">Customer Name <span class="reqd">*</span> </label>
                                                    <label ID="lblAlertProspect" Style="padding: 3px; left: 211px; top: 38px; display: block; position: absolute; color: Gray; background-color: White; display:none"
                                                           class="roundCorner transparent shadow">You have not selected the existing customer/lead. This will add new lead.</label>

                                                    <input type="button" ID="btnSelectCustomer" CausesValidation="False"
                                                           Style="display: block;" value="Button" />

                                                    <input type="text" ID="txtCustomer" onkeydown="return (event.keyCode!=13);" autocomplete="off" />

                                                </div>
                                            </div>
                                            <div class="srchclr btnlinksicon rowbtn">
                                                <a ID="lnkConvert" CausesValidation="False" ToolTip="Convert Lead"><i class="mdi-communication-ring-volume" style="margin-left:0px !important;"></i></a>

                                            </div>
                                            <div class="srchclr btnlinksicon rowbtn">
                                                <a for="txtCustomer" ID="lnkCustomerID"><i class="mdi-social-people" style="margin-left:0px !important;"></i></a>
                                            </div>
                                            <div class="input-field col s12">
                                                <div class="row">
                                                    <label for="txtLocation">Location Name <span class="reqd">*</span> </label>

                                                    <input type="text" ID="txtLocation" onkeydown="return (event.keyCode!=13);" autocomplete="off" />

                                                    <input type="button" ID="btnSelectLoc" CausesValidation="False"
                                                           Style="display: block;" value="Button" />
                                                </div>
                                            </div>

                                            <div class="srchclr multirowbtn multirowbtnone" style="float: right; margin-right: 40px !important;" title="Credit Hold">
                                                <img id="imgCreditH" title="Credit Hold" src="~/MOMUI/images/MSCreditHold.png" style="width: 20px;display:none">
                                            </div>
                                            <div class="srchclr btnlinksicon rowbtn">
                                                <a for="txtLocation" ID="lnkLocationID"><i class="mdi-communication-location-on" style="margin-left:0px !important;"></i></a>
                                            </div>

                                            <div class="input-field col s12">
                                                <div class="row">

                                                    <label for="txtAcctno">Location ID </label>
                                                    <input type="text" ID="txtAcctno" TabIndex="7" Style="background-color: white;" MaxLength="15" />

                                                </div>
                                            </div>


                                            <div class="input-field col s12" id="dvCompanyPermission">
                                                <div class="row">

                                                    <label for="txtCompany">Company <span class="reqd">*</span></label>
                                                    <input type="text" ID="txtCompany" Enabled="false" />
                                                </div>
                                            </div>

                                            <div class="input-field col s12" style="display: block;">
                                                <div class="row">


                                                    <label ID="lblSageid" for="txtCustSageID">SageID</label>
                                                    <span class="reqd">*</span>

                                                    <input type="text" ID="txtCustSageID" class="validate" style="width:137px" MaxLength="10" />
                                                </div>
                                            </div>
                                            <label class="drpdwn-label" style="width: 100%">
                                                Equipment
                                            </label>
                                            <div class="input-field col s12" style="margin-top: -10px;">
                                                <div class="row">

                                                    <div class="tag-div materialize-textarea textarea-border" id="eqtag" style="">
                                                    </div>

                                                    <div id="DivEqup" class="popup_div " style="width: 1000px; z-index: 5">
                                                        <div class="btnlinks" style="margin-bottom: 5px;">
                                                            <a ID="HyperLinkAddEquip">Add New</a>
                                                        </div>
                                                        <div class="btnlinks" style="margin-bottom: 5px; float: right;">
                                                            <a CausesValidation="false" ID="HideMELinkButton1" onclick="HideME();">Close</a>
                                                        </div>


                                                        <div class="grid_container">
                                                            <div class="RadGrid RadGrid_Material FormGrid">



                                                            </div>
                                                        </div>
                                                    </div>


                                                    <input type="text" ID="txtUnit" Style="display: block;" />
                                                    <input type="button" ID="btnEquip" CausesValidation="False" value="Button" />

                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-section3-blank">
                                            &nbsp;
                                        </div>
                                        <div class="form-section3">
                                            <div class="section-ttle">Location Info</div>
                                            <div class="nlne text-field col s12" id="divlocContractinfo">
                                                <div class="row txtrow">
                                                    <label id="locContractinfo"></label>
                                                    <a ID="lnkbtnlocContractinfo" Style="color: #1565C0; margin-left: -15px; text-decoration: underline;" CausesValidation="False">
                                                        Multiple Contract
                                                    </a>
                                                </div>
                                            </div>

                                            @*<%--Button for Multiple Contract Info--%>*@


                                            <div class="input-field col s12">
                                                <div class="row">
                                                    <div>
                                                        <label id="lblgoogleloc" for="txtGoogleAutoc" class="drpdwn-label">Location Address</label>
                                                    </div>
                                                    <input type="text" TextMode="MultiLine" class="materialize-textarea" ID="txtGoogleAutoc" placeholder=""
                                                           onkeyup="return checkMaxLength(this, event, 35)" />
                                                </div>

                                            </div>

                                            <div class="input-field col s5">
                                                <div class="row">
                                                    <input type="text" ID="txtCity" MaxLength="50"
                                                           TabIndex="15" />
                                                    <label for="txtCity">City</label>
                                                </div>
                                            </div>
                                            <div class="input-field col s2">
                                                <div class="row">
                                                    &nbsp;
                                                </div>
                                            </div>
                                            <div class="input-field col s5">
                                                <div class="row">
                                                    <label>State/Province</label>
                                                    <input type="text" ID="ddlState" MaxLength="2"
                                                           TabIndex="20" />
                                                </div>
                                            </div>
                                            <div class="input-field col s5">
                                                <div class="row">
                                                    <input type="text" ID="txtZip" MaxLength="10"
                                                           TabIndex="21" />
                                                    <label for="txtZip">Zip/Postal Code</label>
                                                </div>
                                            </div>
                                            <div class="input-field col s2">
                                                <div class="row">
                                                    &nbsp;
                                                </div>
                                            </div>
                                            <div class="input-field col s5">
                                                <div class="row">
                                                    <label for="txtCountry">Country</label>
                                                    <input type="text" ID="txtCountry" />
                                                </div>
                                            </div>


                                        </div>
                                        <div class="form-section3-blank">
                                            &nbsp;
                                        </div>
                                        <div class="form-section3">
                                            <div class="section-ttle">Main Contact Info</div>
                                            <div class="input-field col s5">
                                                <div class="row">
                                                    <input type="text" ID="txtMaincontact" MaxLength="50"
                                                           TabIndex="25" />
                                                    <label for="txtMaincontact">Main Contact</label>
                                                </div>
                                            </div>
                                            <div class="input-field col s2">
                                                <div class="row">
                                                    &nbsp;
                                                </div>
                                            </div>
                                            <div class="input-field col s5">
                                                <div class="row">
                                                    <input type="text" ID="txtNameWho" MaxLength="30"
                                                           TabIndex="30" />
                                                    <label for="txtNameWho">Caller<span class="reqd">*</span></label>
                                                </div>
                                            </div>
                                            <div class="input-field col s5">
                                                <div class="row">
                                                    <input type="text" ID="txtPhoneCust" MaxLength="28"
                                                           Style="padding: 1px 1px 1px 1px;"
                                                           TabIndex="28" />
                                                    <label for="txtPhoneCust">Contact Phone</label>
                                                </div>
                                            </div>
                                            <div class="input-field col s2">
                                                <div class="row">
                                                    &nbsp;
                                                </div>
                                            </div>
                                            <div class="input-field col s5">
                                                <div class="row">
                                                    <input type="text" ID="txtCell" MaxLength="28"
                                                           TabIndex="32" />
                                                    <label for="txtCell">Caller Phone</label>
                                                </div>
                                            </div>
                                            <div class="input-field col s12">
                                                <div class="row">
                                                    <label class="label">Entered By</label>
                                                    <input type="text" ID="txtFby" class="browser-default" />
                                                </div>
                                            </div>
                                            <div class="input-field2 col s5">
                                                <div class="row">
                                                    <label class="date-label">Date Called In<span class="reqd">*</span></label>
                                                    <input type="text" ID="txtCallDt" class="datepicker_mom" MaxLength="28"
                                                           TabIndex="17" />
                                                </div>
                                            </div>


                                            <div class="input-field col s2">
                                                <div class="row">
                                                    &nbsp;
                                                </div>
                                            </div>

                                            <div class="input-field col s5">
                                                <div class="row">
                                                    <input type="text" ID="txtCallTime" class="validate" TabIndex="18" MaxLength="28" />
                                                    <label>Called In Time<span class="reqd">*</span></label>

                                                </div>
                                            </div>

                                            <div class="input-field col s5">
                                                <div class="row">
                                                    <label class="drpdwn-label" id="lblDefaultWorker"></label>

                                                    <select ID="ddlDefRoute" disabled TabIndex="37" Style="margin-left: 3px" class="browser-default" onchange="CallNearestWorker();">
                                                        <option>Select</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="input-field col s2">
                                                <div class="row">
                                                    &nbsp;
                                                </div>
                                            </div>
                                            <div class="input-field col s5">
                                                <div class="row">
                                                    <label class="drpdwn-label" id="lblZone">Zone</label>
                                                    <select ID="ddlZone" class="browser-default">
                                                        <option>Select</option>
                                                    </select>
                                                </div>
                                            </div>

                                        </div>
                                    </div>

                                    <div class="form-section-row">

                                        <div class="form-section3">
                                            <div class="section-ttle">Service Info</div>
                                            <div class="input-field col s5">
                                                <div class="row">
                                                    <label class="drpdwn-label">
                                                        Category <span class="reqd">*</span>
                                                    </label>

                                                    <select ID="ddlCategory" class="browser-default" AutoPostBack="True"
                                                            TabIndex="16">
                                                        <option>Select</option>
                                                    </select>
                                                </div>
                                                <div class="srchclr btnlinksicon rowbtn">
                                                    <img ID="imgCategory" AlternateText="Icon" ToolTip="Category Icon"
                                                         style="width:25px" />
                                                </div>
                                            </div>

                                            <div class="input-field col s2">
                                                &nbsp;
                                            </div>
                                            <div class="input-field col s5">
                                                <div class="row">
                                                    <label class="drpdwn-label">Level</label>
                                                    <select ID="ddlLevel" class="browser-default">
                                                        <option>Select</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="input-field col s12" style="margin-top: 20px!important">


                                                <div class="row">

                                                    <a CausesValidation="False" Style="float: right; padding: 0 0px 0 0px;" ID="btnCodes">
                                                        <i class="mdi-content-add-box" style="font-size: 1.5em; color: #1565c0; line-height: 20px;"></i>
                                                    </a>



                                                    <label for="txtReason" class="drpdwn-label">
                                                        Reason for service<span class="reqd">*</span>
                                                    </label>
                                                    <textarea ID="txtReason" rows="2" cols="20"
                                                              TextMode="MultiLine" Style="padding: 0.4rem 0 !important; height:120px"
                                                              class="materialize-textarea textarea-border"></textarea>
                                                </div>

                                            </div>
                                        </div>
                                        <div class="form-section3-blank">
                                            &nbsp;
                                        </div>
                                        <div class="form-section3">
                                            <div class="section-ttle">
                                                Worker Info
                                                <span style="float: right;">
                                                    <span class="css-checkbox">
                                                        <input type="checkbox" ID="chkCreateMultipleTicket" />
                                                        <label for="chkCreateMultipleTicket" style="font-size:100%">Multiple Ticket</label>
                                                    </span>
                                                    <a ID="btnchkCreateMultipleTicket" Style="display: none;" CausesValidation="false"></a>

                                                </span>
                                            </div>

                                            <div class="input-field2 col s5">
                                                <div class="row">
                                                    <label class="date-label">Date Scheduled<span class="reqd">*</span></label>
                                                    <input type="text" ID="txtSchDt" class="datepicker_mom" MaxLength="28"
                                                           TabIndex="23" />
                                                </div>
                                            </div>

                                            <div class="input-field col s2">
                                                <div class="row">
                                                    &nbsp;
                                                </div>
                                            </div>
                                            <div class="input-field col s5">
                                                <div class="row">

                                                    <label>Time<span class="reqd">*</span></label>
                                                    <input type="text" ID="txtSchTime" class="validate" TabIndex="24" MaxLength="28" />
                                                </div>
                                            </div>

                                            <div class="input-field2 col s5">
                                                <div class="row">
                                                    <label for="txtEST">Estimate</label>
                                                    <input type="text" ID="txtEST" class="validate valid" MaxLength="28"
                                                           tabindex="36" value="00.00" />
                                                </div>
                                            </div>
                                            <div class="input-field col s2">
                                                <div class="row">
                                                    &nbsp;
                                                </div>
                                            </div>

                                            <div class="input-field col s5" id="divForCreateMultipleTicket">
                                                <div class="row">
                                                    <label for="txtDays">Days</label>
                                                    <input type="text" ID="txtDays" TextMode="Number" Text="1" class="validate" />
                                                </div>
                                            </div>
                                            <div class="input-field col s12" id="divForCreateMultipleTicket3">
                                                <div class="row">
                                                    <label class="drpdwn-label" style="width: 100%">
                                                        Assigned Worker<span class="reqd">*</span>
                                                    </label>

                                                    <select ID="ddlRoute1" class="browser-default" TabIndex="30"
                                                            AutoPostBack="True">
                                                        <option>Select</option>
                                                    </select>
                                                </div>
                                            </div>

                                            <div class="input-field col s12 mgntp10" id="divForCreateMultipleTicket2">
                                                <div class="row">
                                                    <label class="drpdwn-label">
                                                        Assigned Worker
                                                    </label>

                                                    @*<telerik:RadComboBox ID="chkcatlist" BackColor="White" CssClass="browser-default" CheckBoxes="true" Width="102%"
                                                                             EnableCheckAllItemsCheckBox="true">
                                                        </telerik:RadComboBox>*@
                                                    <span class="rcbInner rcbReadOnly">
                                                        <input name="chkcatlist" type="text" class="rcbInput radPreventDecorate" id="chkcatlist_Input" checked readonly="readonly" style="background-color:White;" autocomplete="off">
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="input-field col s12">
                                                <div class="row">
                                                    <label class="drpdwn-label">Status</label>
                                                    <select ID="ddlStatus1" AutoPostBack="True" class="browser-default">
                                                        <option Value="0">Un-Assigned</option>
                                                        <option Value="1">Assigned</option>
                                                        <option Value="2">Enroute</option>
                                                        <option Value="3">Onsite</option>
                                                        <option Value="4">Completed</option>
                                                        <option Value="5">Hold</option>
                                                        <option Value="6" disabled="disabled">Voided</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-section3-blank">
                                            &nbsp;
                                        </div>

                                        <div class="form-section3">
                                            <div class="section-ttle">Additional Info</div>
                                            <div>
                                                <div class="input-field col s4">
                                                    <div class="checkrow">
                                                        <span class="css-checkbox">
                                                            <input type="checkbox" ID="chkDispAlert" />
                                                        </span>
                                                        <label for="chkDispAlert">Dispatch Alert</label>
                                                    </div>
                                                </div>
                                                <div class="input-field col s4" style="float: right !important;">
                                                    <div class="checkrow">
                                                        <span class="css-checkbox">
                                                            <input type="checkbox" ID="chkIsRecurring" />
                                                        </span>
                                                        <label for="chkIsRecurring">Recurring</label>
                                                    </div>
                                                </div>
                                                <div class="input-field col s4" style="float: right !important;">
                                                    <div class="checkrow">
                                                        <span class="css-checkbox">
                                                            <input type="checkbox" ID="chkCreditHold" />
                                                        </span>
                                                        <label for="chkCreditHold">Credit Hold</label>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="input-field col s12" style="margin-top: 20px !important;">
                                                <div class="row">
                                                    <textarea ID="txtCreditReason" rows="2" cols="20" class="materialize-textarea" TextMode="MultiLine" ToolTip="Reason"></textarea>
                                                    <label for="txtCreditReason">Reason</label>
                                                </div>
                                            </div>
                                            <div class="input-field col s12">
                                                <div class="row">

                                                    <textarea ID="txtRemarks" rows="2" cols="20" MaxLength="8000"
                                                              TextMode="MultiLine" Style="padding: 0.4rem 0 !important; height:120px"
                                                              class="materialize-textarea textarea-border"></textarea>

                                                    <label ID="lblRemarks" for="txtRemarks" class="txtbrdlbl">Location Remarks</label>
                                                </div>
                                            </div>

                                        </div>


                                    </div>

                                    <div class="cf"></div>
                                </div>
                                @*</telerik:RadAjaxPanel>*@
                            </div>
                        </div>

                    </li>
                    <li>

                        <div id="accrdcompleted" class="collapsible-header accrd accordian-text-custom">
                            <i class="mdi-action-perm-data-setting"></i>Completed
                            <label ID="lblaccrdcompleted" ForeColor="Red">(You do not have completed ticket permissions!)</label>
                        </div>

                        <div class="collapsible-body">
                            <div class="form-content-wrap">
                                @*<telerik:RadAjaxPanel ID="RadAjaxPanelCompleted">*@
                                <div class="form-content-pd" id="DIVaccrdcompleted">
                                    <div class="form-section-row">
                                        <div class="input-field s12" style="margin-top: 0px !important; position: relative; margin-bottom: 50px;">


                                            <div class="form-section3">
                                                <div class="input-field col s4">
                                                    <div class="checkrow">
                                                        <span class="css-checkbox">
                                                            <input type="checkbox" ID="chkWorkComp" checked TabIndex="11" />
                                                        </span>
                                                        <label for="chkWorkComp">Work Complete</label>
                                                    </div>
                                                </div>

                                                <div class="input-field col s3">
                                                    <div class="checkrow">
                                                        <span class="css-checkbox">
                                                            <input type="checkbox" ID="chkReviewed" />
                                                        </span>
                                                        <label for="chkReviewed">Reviewed</label>
                                                    </div>
                                                </div>

                                                <div class="input-field col s3">
                                                    <div class="checkrow">
                                                        <span class="css-checkbox">
                                                            <input type="checkbox" ID="chkChargeable" onclick="ChargeableCheck()" />
                                                        </span>
                                                        <label for="chkChargeable">Chargeable</label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-section3-blank">

                                            </div>
                                            <div class="form-section3">

                                                <div class="input-field col s3">
                                                    <div class="checkrow">
                                                        <span class="css-checkbox">
                                                            <input type="checkbox" ID="chkInvoice" />
                                                        </span>
                                                        <label for="chkInvoice">Invoice</label>
                                                    </div>
                                                </div>
                                                <div class="input-field col s3">
                                                    <div class="checkrow">
                                                        <span class="css-checkbox">
                                                            <input type="checkbox" ID="chkTimeTrans" />
                                                        </span>
                                                        <label for="chkTimeTrans">Timesheet</label>
                                                    </div>
                                                </div>
                                                <div class="input-field col s3">
                                                    <div class="checkrow">
                                                        <span class="css-checkbox">
                                                            <input type="checkbox" ID="chkPayroll" />
                                                        </span>
                                                        <label for="chkPayroll">Payroll</label>
                                                    </div>
                                                </div>
                                                <div class="input-field col s3">
                                                    <div class="checkrow">
                                                        <span class="css-checkbox">
                                                            <input type="checkbox" ID="Internet" />
                                                        </span>
                                                        <label for="chkInternet">Internet</label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-section3-blank">
                                                &nbsp;
                                            </div>

                                            <div class="form-section3-blank">
                                                &nbsp;
                                            </div>
                                            <div class="form-section3">
                                            </div>
                                        </div>
                                        <div class="form-section3">
                                            <div class="section-ttle">Work Description</div>

                                            <div class="input-field col s12">
                                                <div class="row">
                                                    <span style="float: right;">
                                                        <a CausesValidation="False" ID="btnCodesCmpl" style="display:none">
                                                            <i class="mdi-content-add-box" style="font-size: 1.5em; color: #1565c0;"></i>
                                                        </a>
                                                    </span>
                                                    <textarea ID="txtWorkCompl" rows="2" cols="20"
                                                              style="padding: 0.4rem 0 !important"
                                                              class="materialize-textarea textarea-border" TabIndex="39"></textarea>
                                                    <label for="txtWorkCompl" class="txtbrdlbl">
                                                        Work Complete Desc.<span class="reqd">*</span>
                                                    </label>
                                                    <label ID="lblWCD"></label>
                                                </div>
                                            </div>
                                            <div>
                                                <label class="drpdwn-label">Signature</label>
                                            </div>
                                            <div class="input-field col s12">
                                                <div class="row">
                                                    <div id="signbg" style="border: 1px solid #9e9e9e; width: 100%; height: 123px; border-radius: 5px;">
                                                        <img ID="imgSign" Style="width: 99%; max-height: 99%;" />
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-section3-blank">
                                            &nbsp;
                                        </div>
                                        <div class="form-section3">
                                            <div class="section-ttle">
                                                Timestamps
                                            </div>
                                            <div class="input-field col s5">
                                                <div class="row">
                                                    <label class="drpdwn-label">Assigned Worker<span class="reqd">*</span></label>
                                                    <label ID="lblWorkStatus" Font-Size="Smaller" ForeColor="Red"></label>

                                                    <select ID="ddlRoute" class="browser-default" TabIndex="30"
                                                            AutoPostBack="True">
                                                        <option>Select</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="input-field col s2">
                                                <div class="row">
                                                    &nbsp;
                                                </div>
                                            </div>
                                            <div class="input-field col s5">
                                                <div class="row">
                                                    <label class="drpdwn-label">Status</label>
                                                    <select ID="ddlStatus" class="browser-default">
                                                        <option Value="0">Un-Assigned</option>
                                                        <option Value="1">Assigned</option>
                                                        <option Value="2">Enroute</option>
                                                        <option Value="3">Onsite</option>
                                                        <option Value="4">Completed</option>
                                                        <option Value="5">Hold</option>
                                                        <option Value="6" disabled="disabled">Voided</option>
                                                    </select>
                                                    <a ID="lnkddlStatus" CausesValidation="false"> </a>

                                                </div>
                                            </div>

                                            @*<telerik:RadAjaxPanel ID="RadAjaxPanelTimestamps">*@
                                            <div class="section-ttle" style="margin-top: 15px;">
                                                Time Spent
                                                <span style="float: right;">
                                                    <label style="height: 20px !important; font-size: 1em !important;">
                                                        Total:<label ID="lblTotal" Style="font-weight: bold;">0.0</label>
                                                        Hrs
                                                    </label>
                                                </span>
                                                @Html.Hidden("txtTotal", "0")
                                            </div>

                                            <div class="input-field2 col s3">
                                                <div class="row">
                                                    <input type="text" ID="txtRT" TextMode="Number" MaxLength="28"
                                                           step="any" TabIndex="15" value="0.00" />
                                                    <label for="txtRT">RT</label>

                                                </div>
                                            </div>
                                            <div class="input-field col s1">
                                                <div class="row">
                                                    &nbsp;
                                                </div>
                                            </div>
                                            <div class="input-field col s3">
                                                <div class="row">
                                                    <input type="text" ID="txtOT" TextMode="Number" MaxLength="28"
                                                           step="any" TabIndex="16" value="0.00" />
                                                    <label for="txtOT">OT</label>
                                                </div>
                                            </div>
                                            <div class="input-field col s1">
                                                <div class="row">
                                                    &nbsp;
                                                </div>
                                            </div>
                                            <div class="input-field col s4">
                                                <div class="row">
                                                    <input type="text" ID="txtEnrTime" MaxLength="28" />
                                                    <label ID="lblenroute" for="txtEnrTime">
                                                        <a ID="btnEnroute" CausesValidation="False" Style="color: #1565C0; margin-left: -15px;">Enroute</a>
                                                    </label>
                                                </div>
                                            </div>

                                            <div class="input-field2 col s3">
                                                <div class="row">
                                                    <input type="text" ID="txtNT" MaxLength="28"
                                                           step="any" TabIndex="17" value="0.00" />
                                                    <label for="txtNT">1.7</label>

                                                </div>
                                            </div>
                                            <div class="input-field col s1">
                                                <div class="row">
                                                    &nbsp;
                                                </div>
                                            </div>
                                            <div class="input-field col s3">
                                                <div class="row">
                                                    <input type="text" ID="txtDT" TextMode="Number" MaxLength="28"
                                                           step="any" TabIndex="18" value="0.00" />

                                                    <label for="txtDT">DT</label>
                                                </div>
                                            </div>
                                            <div class="input-field col s1">
                                                <div class="row">
                                                    &nbsp;
                                                </div>
                                            </div>
                                            <div class="input-field col s4">
                                                <div class="row">
                                                    <input type="text" ID="txtOnsitetime" MaxLength="28" />
                                                    <label>
                                                        <a ID="btnOnsite" CausesValidation="False" Style="color: #1565C0; margin-left: -15px;">Onsite</a>
                                                    </label>
                                                </div>
                                            </div>

                                            <div class="input-field2 col s3">
                                                <div class="row">
                                                    <input type="text" ID="txtTT" TextMode="Number" MaxLength="28"
                                                           step="any" TabIndex="19" value="0.00" />
                                                    <label for="txtTT">TT</label>

                                                </div>
                                            </div>
                                            <div class="input-field col s1">
                                                <div class="row">
                                                    &nbsp;
                                                </div>
                                            </div>
                                            <div class="input-field col s3">
                                                <div class="row">
                                                    <input type="text" ID="txtBT" TextMode="Number" MaxLength="28"
                                                           step="any" TabIndex="19" value="0.00" />
                                                    <label for="txtBT">BT</label>
                                                </div>
                                            </div>
                                            <div class="input-field col s1">
                                                <div class="row">
                                                    &nbsp;
                                                </div>
                                            </div>
                                            <div class="input-field col s4">
                                                <div class="row">
                                                    <input type="text" ID="txtComplTime" MaxLength="28"
                                                           TabIndex="30" />
                                                    <label>
                                                        <a ID="btnComplete" CausesValidation="False" Style="color: #1565C0; margin-left: -15px;">Complete</a>
                                                    </label>
                                                </div>
                                            </div>
                                            @*</telerik:RadAjaxPanel>*@
                                        </div>
                                        <div class="form-section3-blank">
                                            &nbsp;
                                        </div>
                                        <div class="form-section3">
                                            <div class="section-ttle">Project Info</div>


                                            <div class="input-field col s5">
                                                <div class="row">
                                                    <label for="txtProject">
                                                        Project#
                                                    </label>
                                                    <input type="text" ID="projectNo" Style="pointer-events: none; color: darkgrey" class="validate" />

                                                    <input type="button" ID="btnGetCode" CausesValidation="False" value="Button" Style="display: block;" />
                                                </div>
                                            </div>
                                            <div class="input-field col s2">
                                                <div class="row">
                                                    &nbsp;
                                                </div>
                                            </div>
                                            <div class="input-field col s5">
                                                <div class="row">

                                                    <label class="drpdwn-label">New Project Template<span class="reqd">*</span></label>
                                                    <select ID="ddlTemplate" onchange="ToggleValidator();"
                                                            class="browser-default">
                                                        <option>Select</option>
                                                    </select>

                                                </div>
                                            </div>
                                            <div class="input-field col s12">
                                                <div class="row">


                                                    <label for="txtJobCode">
                                                        Project Type
                                                        <a id="aref" style="color: #5b9bd1; display: none;" href="#">
                                                            <i class="mdi-navigation-refresh" style="font-size: 1.2em; color: #1565c0; line-height: 5px;"></i>

                                                        </a>
                                                    </label>

                                                    <input type="text" TabIndex="3" ID="txtJobCode" autocomplete="off" />
                                                    <div id="DivprojectType" class="popup_div" style="width: 450px; z-index: 2">
                                                        <div class="btnlinks" style="margin-bottom: 5px; float: right;">
                                                            <a CausesValidation="false" ID="HideMELinkButton2" onclick="HideME();">Close</a>
                                                        </div>
                                                        <div class="grid_container">
                                                            <div class="RadGrid RadGrid_Material FormGrid">

                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="input-field col s12">
                                                <div class="row">
                                                    <label class="drpdwn-label">Department</label>

                                                    <select ID="ddlDepartment" class="browser-default"
                                                            TabIndex="22">
                                                        <option>Select</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="input-field col s12">
                                                <div class="row">
                                                    <label class="drpdwn-label">Wage<span class="reqd">*</span></label>
                                                    <select ID="ddlWage" class="browser-default"
                                                            TabIndex="22">
                                                        <option>Select</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div id="QbpayrollDiv">

                                                <div class="input-field col s5">
                                                    <div class="row">
                                                        <label class="drpdwn-label">Service Item</label>
                                                        <select ID="ddlService" class="browser-default"
                                                                TabIndex="26"
                                                                AutoPostBack="True">
                                                            <option>Select</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="input-field col s2">
                                                    <div class="row">
                                                        &nbsp;
                                                    </div>
                                                </div>
                                                <div class="input-field col s5">
                                                    <div class="row">
                                                        <label class="drpdwn-label">Payroll Item</label>
                                                        <select ID="ddlPayroll" class="browser-default"
                                                                TabIndex="31">
                                                            <option>Select</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </div>

                                    <div class="form-section-row">
                                        <div class="form-section3">
                                            <div class="section-ttle">
                                                More Details
                                            </div>
                                            <div class="input-field col s12">
                                                <div class="row">
                                                    <textarea ID="txtRecommendation" rows="2" cols="20" class="materialize-textarea" Style="min-height: 2.1em; max-height: 7.1em; overflow-y: auto; height:50px"
                                                              Enabled="False" TextMode="MultiLine"></textarea>
                                                    <label for="txtRecommendation">Recommendation</label>
                                                </div>
                                            </div>
                                            <div class="input-field col s12">
                                                <div class="row">
                                                    <textarea ID="txtPartsUsed" rows="2" cols="20"
                                                              Style="position: relative; z-index: 1"
                                                              TextMode="MultiLine"
                                                              class="materialize-textarea" TabIndex="40"></textarea>
                                                    <label for="txtPartsUsed">Parts Used</label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-section3-blank">
                                            &nbsp;
                                        </div>
                                        <div class="form-section3">
                                            <div class="section-ttle">Comments</div>

                                            <div class="input-field col s12">
                                                <div class="row">
                                                    <textarea ID="txtComments" rows="2" cols="20"
                                                              TextMode="MultiLine" Style="padding: 0.4rem 0 !important"
                                                              class="materialize-textarea textarea-border" TabIndex="39"></textarea>
                                                    <label for="txtComments" class="txtbrdlbl">
                                                        Comments
                                                    </label>

                                                </div>
                                            </div>


                                        </div>
                                        <div class="form-section3-blank">
                                            &nbsp;
                                        </div>
                                        <div class="form-section3">
                                            <div class="section-ttle">
                                                Expenses
                                                <span style="float: right;">
                                                    <label style="height: 20px !important; font-size: 1em !important;">
                                                        Total Exp: $
                                                        <label ID="lblTotalExp" Style="font-weight: bold;">0.00</label>
                                                    </label>
                                                    <label style="height: 20px !important; font-size: 1em !important;">
                                                        || Traveled Miles:
                                                        <label ID="txtMileTraveled" Style="font-weight: bold;">0.00</label>
                                                    </label>
                                                </span>
                                            </div>

                                            <div class="input-field col s5">
                                                <div class="row">
                                                    <input type="text" ID="txtExpMisc" TextMode="Number" MaxLength="28"
                                                           step="any" TabIndex="19" value="0.00" />
                                                    <label for="txtExpMisc">Miscellaneous</label>
                                                </div>
                                            </div>
                                            <div class="input-field col s2">
                                                <div class="row">
                                                    &nbsp;
                                                </div>
                                            </div>
                                            <div class="input-field col s5">
                                                <div class="row">
                                                    <input type="text" ID="txtMileStart" TextMode="Number"
                                                           MaxLength="28" step="any" TabIndex="19" value="0.00" />

                                                    <label for="txtMileStart">Starting Mileage</label>
                                                </div>
                                            </div>

                                            <div class="input-field col s5">
                                                <div class="row">
                                                    <input type="text" ID="txtExpZone" TextMode="Number" MaxLength="28"
                                                           step="any" TabIndex="19" value="0.00" />

                                                    <label for="txtExpZone">Zone</label>
                                                </div>
                                            </div>
                                            <div class="input-field col s2">
                                                <div class="row">
                                                    &nbsp;
                                                </div>
                                            </div>
                                            <div class="input-field col s5">

                                                <div class="row">
                                                    <input type="text" ID="txtMileEnd" TextMode="Number"
                                                           MaxLength="28" step="any" TabIndex="19" value="0.00" />
                                                    <label for="txtMileEnd">Ending Mileage</label>
                                                </div>
                                            </div>
                                            <div class="input-field col s5">
                                                <div class="row">

                                                    <input type="text" ID="txtExpToll" TextMode="Number" MaxLength="28"
                                                           step="any" TabIndex="19" value="0.00" />

                                                    <label for="txtExpToll">Toll</label>
                                                </div>
                                            </div>
                                            <div class="input-field col s2">
                                                <div class="row">
                                                    &nbsp;
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                                @*</telerik:RadAjaxPanel>*@
                            </div>
                            <div style="clear: both;"></div>
                        </div>

                    </li>
                    <li>
                        <div id="accrdcustom" class="collapsible-header accrd accordian-text-custom"><i class="mdi-action-perm-data-setting"></i>Custom</div>
                        <div class="collapsible-body">
                            <div class="form-content-wrap">
                                <div class="form-content-pd">
                                    <div class="form-section2">
                                        <div class="section-ttle">Custom Fields</div>
                                        <div class="input-field col s12">
                                            <div class="row">

                                                <label for="txtTickCustom1">
                                                    <label for="txtCst1" ID="lblCustom1"></label>
                                                </label>
                                                <input type="text" ID="txtCst1" />

                                            </div>
                                        </div>
                                        <div class="input-field col s12">
                                            <div class="row">
                                                <label ID="lblCustom2" for="txtCst2"></label>
                                                <input type="text" ID="txtCst2" />
                                            </div>
                                        </div>

                                        <div class="input-field col s12">
                                            <div class="row">
                                                <label ID="lblCustom3" for="txtCst3"></label>
                                                <input type="text" ID="txtCst3" />
                                            </div>
                                        </div>
                                        <div class="input-field col s12">
                                            <div class="row">
                                                <label ID="lblCustom4" for="txtCst4"></label>
                                                <input type="text" ID="txtCst4" />

                                            </div>
                                        </div>
                                        <div class="input-field col s12">
                                            <div class="row">
                                                <label ID="lblCustom5" for="txtCst5"></label>
                                                <input type="text" ID="txtCst5" />
                                            </div>
                                        </div>

                                        <div class="input-field col s6">
                                            <div class="checkrow">
                                                <span class="filled-in">
                                                    <input type="checkbox" ID="chkCst1" />
                                                </span>
                                                <label ID="lblCustom6" for="chkCst1"></label>
                                            </div>
                                        </div>
                                        <div class="input-field col s6">
                                            <div class="checkrow">
                                                <input type="checkbox" ID="chkCst2" />
                                                <label ID="lblCustom7" for="chkCst2"></label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-section3-blank">
                                        &nbsp;
                                    </div>
                                    <div class="form-section2">
                                        <div class="section-ttle">Ticket Custom Fields</div>

                                        <div class="input-field col s12">
                                            <div class="row">
                                                <input type="text" ID="txtTickCustom1" TabIndex="39" />
                                                <label for="txtTickCustom1">
                                                    Ticket Custom 1
                                                </label>
                                            </div>
                                        </div>

                                        <div class="input-field col s12">
                                            <div class="row">
                                                <input type="text" ID="txtTickCustom2" TabIndex="40" />
                                                <label for="txtTickCustom2">
                                                    Ticket Custom 2
                                                </label>
                                            </div>
                                        </div>
                                        <div class="input-field col s12">
                                            <div class="row">
                                                <input type="text" ID="txtTickCustom3" TabIndex="41" MaxLength="28" />
                                                <label ID="lblCustomTick5" for="txtTickCustom3">Ticket Custom 3</label>
                                            </div>
                                        </div>

                                        <div class="input-field col s6">
                                            <div class="checkrow">
                                                <span class="css-checkbox">
                                                    <input type="checkbox" ID="chkTickCustom1" />
                                                </span>
                                                <label for="chkTickCustom1">Ticket Checkbox 1</label>
                                            </div>
                                        </div>
                                        <div class="input-field col s6">
                                            <div class="checkrow">
                                                <span class="css-checkbox">
                                                    <input type="checkbox" ID="chkTickCustom2" />
                                                </span>
                                                <label for="chkTickCustom2">Ticket Checkbox 2</label>

                                            </div>
                                        </div>
                                    </div>

                                    <div class="cf"></div>
                                </div>
                            </div>
                            <div style="clear: both;"></div>
                        </div>
                    </li>

                    <li>
                        <div id="accrdResolution" style="display: block;" class="collapsible-header accrd accordian-text-custom"><i class="mdi-action-perm-data-setting"></i>Resolution Tasks</div>
                        <div class="collapsible-body">
                            <div class="form-content-wrap">
                                <div class="form-content-pd">
                                    <div class="form-section-row">
                                        <div class="section-ttle">Resolution Tasks</div>
                                        <div class="grid_container">
                                            <div class="form-section-row">
                                                <div class="RadGrid RadGrid_Material FormGrid">
                                                    @*<asp:Repeater ID="rptCodesList">*@
                                                    <table id="tblCodesList">
                                                        <tr>
                                                            <th>Code</th>
                                                            <th>Updated</th>
                                                            <th>Ticket#</th>
                                                        </tr>
                                                        <tr>
                                                            <td>
                                                                <input type="checkbox" ID="chkCode" onchange="checkedHidden(this);" />
                                                                @Html.Hidden("hdnCodeCat", "<%# Eval('category') %>")
                                                                @Html.Hidden("hdnTicket")
                                                                @Html.Hidden("hdnDate")
                                                                @Html.Hidden("hdnUsername")
                                                                @Html.Hidden("hdnChecked")
                                                            </td>
                                                            <td>
                                                                <label ID="lblDescRP"></label>
                                                            </td>
                                                            <td>
                                                                <a ID="lnkTicket"></a>
                                                            </td>
                                                        </tr>

                                                    </table>

                                                    @*</asp:Repeater>*@
                                                    <label ID="lblResolutionTasks">No Record Found...</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div style="clear: both;"></div>
                        </div>
                    </li>
                    <li>
                        <div id="accrdMCP" style="display: block;" class="collapsible-header accrd accordian-text-custom"><i class="mdi-action-perm-data-setting"></i>MCP</div>
                        <div class="collapsible-body">
                            <div class="form-content-wrap">
                                <div class="form-content-pd">
                                    <div class="form-section-row">
                                        <div class="section-ttle">MCP</div>
                                        <div class="grid_container">
                                            <div class="form-section-row">
                                                <div class="RadGrid RadGrid_Material FormGrid">



                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div style="clear: both;"></div>
                        </div>
                    </li>
                    <li>
                        <div id="accrdPO" style="display: block;" class="collapsible-header accrd accordian-text-custom"><i class="mdi-action-perm-data-setting"></i>Purchase Orders</div>
                        <div class="collapsible-body">
                            <div class="form-content-wrap">
                                <div class="form-content-pd">
                                    <div class="form-section-row">
                                        <div class="section-ttle">PO</div>

                                        <div class="form-section-row">
                                            <div class="btnlinks">
                                                <a ID="btnaddpo" onclick="return btnaddpoCClick();">Add PO</a>
                                            </div>
                                        </div>
                                        <div class="grid_container">
                                            <div class="form-section-row">
                                                <div class="RadGrid RadGrid_Material FormGrid">

                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div style="clear: both;"></div>
                        </div>
                    </li>
                    <li>

                        <div id="accrddocuments" class="collapsible-header accrd accordian-text-custom"><i class="mdi-action-credit-card"></i>Documents</div>
                        <div class="collapsible-body">
                            <div class="form-content-wrap">
                                <div class="form-content-pd">
                                    <div ID="pnlDocPermission">
                                        <div ID="pnlDocumentButtons">
                                            <div class="form-section-row">
                                                <div class="col s12 m12 l12">
                                                    <!--<p>Maximum file upload size 2MB.</p>-->

                                                    <input type="file" ID="FileUpload1" class="dropify"
                                                           onchange="AddDocumentClick(this);" />
                                                    <!--data-max-file-size="2M"-->
                                                </div>
                                            </div>
                                            <div class="form-section-row">
                                                <div class="btnlinks">
                                                    <a ID="lnkDeleteDoc" CausesValidation="False" ToolTip="Delete"
                                                       onclick="return DeleteDocumentClick(this);">Delete</a>
                                                    <a ID="lnkUploadDoc"
                                                       CausesValidation="False"
                                                       Style="display: block">Upload</a>
                                                    <a ID="lnkPostback"
                                                       CausesValidation="False" Style="display: block">Postback</a>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-section-row">
                                            <div class="grid_container">
                                                <div class="form-section-row">
                                                    <div class="RadGrid RadGrid_Material FormGrid">


                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div style="clear: both;"></div>
                        </div>
                    </li>
                    <li>
                        <div id="accrdInventory" style="display: block;" class="collapsible-header accrd accordian-text-custom"><i class="mdi-notification-vibration"></i>Inventory Used</div>
                        <div class="collapsible-body">
                            <div class="form-content-wrap">
                                <div class="form-content-pd">
                                    <div class="grid_container">
                                        <div class="RadGrid RadGrid_Material FormGrid">


                                        </div>
                                    </div>
                                    <div class="row" style="margin-top: 10px!important;">
                                        <a ID="btnAddNewLines" CausesValidation="false" onclick="itemJSON();" Style="color: #000; font-size: 1.5em;">
                                            <i class="mdi-content-add-circle" style="color: #2bab54;font-size: 1.2em; font-weight: bold;margin-left:10px;"></i>
                                        </a>
                                    </div>
                                    <div class="cf"></div>
                                </div>
                            </div>
                            <div style="clear: both;"></div>
                        </div>
                    </li>
                    <li id="tbLogs">
                        <div id="accrdlogs" class="collapsible-header accrd accordian-text-custom"><i class="mdi-content-content-paste"></i>Logs</div>
                        <div class="collapsible-body">
                            <div class="form-content-wrap">
                                <div class="form-content-pd">
                                    <div class="grid_container">
                                        <div class="form-section-row" style="margin-bottom: 0 !important;">
                                            <div class="RadGrid RadGrid_Material">


                                            </div>

                                        </div>
                                    </div>

                                    <div class="cf"></div>
                                </div>
                            </div>
                            <div style="clear: both;"></div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>



@*<%--  ---------$$$$$$$$$$$$$$$  OLD  Design   $$$$$$$$$$$$$$-----------------%>*@


@*<%--  ------Reason-----%>*@

<div id="pnlTranslate" style="display: none;">
    @Html.Hidden("hdnIsEdited", "0")
    <div>
        Spanish text (sent from/to device)
        <a ID="lnkTransReasonToEnglish" CausesValidation="False">
            Translate to English
        </a>
        <a id="lnkCloseTranslate" onclick="$('#pnlTranslate').hide();" style="float: right; vertical-align: top; margin-right: 10px; cursor: pointer">X</a>
    </div>
    <textarea ID="txtTranslate" rows="2" cols="20"
              TextMode="MultiLine"></textarea>
</div>

<div id="divTransIconReason" style="height: 55px; background-color: Gray; display: none">
    <div style="margin: 5px 5px 5px 5px">
        <a ID="lnkTranslate" CausesValidation="False">
            <img alt="Translate" src="~/MOMUI/Design/images/translate.png" class="shadowHover" title="Translate to Spanish/English"
                 width="20" height="20" />
        </a>
    </div>
    <div style="margin: 5px 5px 5px 5px">

    </div>
</div>

<div class="page-content" style="display: none;">

    <div ID="TabContainer2" ActiveTabIndex="0">
        <div ID="TabPanel1" HeaderText="Ticket Info">
            <div>
                <div class="fc-input">
                    <div id="pnlTransDesc" style="display: block;">
                        <div>
                            Spanish text (sent from/to device)
                            <a ID="lnkTransDescToEnglish" CausesValidation="False">
                                Translate to English
                            </a>

                        </div>
                        <textarea ID="txtTransDesc" rows="2" cols="20"
                                  TextMode="MultiLine"></textarea>
                    </div>
                    <div id="divTransicon" style="width: 30px; height: 55px; background-color: Gray; display: block">
                        <div style="margin: 5px 5px 5px 5px">
                            <a ID="lnkTransEnglish" CausesValidation="False">
                                <img alt="Translate" src="~/MOMUI/Design/images/translate.png" class="shadowHover" title="Translate to Spanish/English"
                                     width="20" height="20" />
                            </a>
                        </div>
                        <div style="margin: 5px 5px 5px 5px">
                            <a id="lnkTransDesc" onclick='$("#pnlTransDesc").show();' tabindex="33">
                                <img alt="Translate" src="~/MOMUI/Design/images/showdiv.png" class="shadowHover" title="Show Spanish Text"
                                     width="20" height="20" />
                            </a>
                        </div>
                    </div>

                    <img ID="imgEmail" style="display: block;" src="~/MOMUI/Design/images/email_notf.png" ToolTip="Email Notified" />
                    <img ID="imgWeekend" style="display: block;" src="~/MOMUI/Design/images/weekend.png" ToolTip="Worked on Weekend" />
                    <img ID="imgAfterHours" style="display: block;" src="~/MOMUI/Design/images/hours.png" ToolTip="Worked Afterhours" />
                </div>
            </div>



        </div>

    </div>
</div>
@*<%-------$$$$$$$$$$$$ HIDDEN FIELD $$$$$$$$$$$$$$$$$$-----%>*@


@Html.Hidden("MSTimeDataFieldVisibility")
@Html.Hidden("HiddenFieldRT")
@Html.Hidden("HiddenFieldOT")
@Html.Hidden("HiddenFieldNT")
@Html.Hidden("HiddenFieldDT")
@Html.Hidden("HiddenFieldTT")
@Html.Hidden("HiddenFieldBT")
@Html.Hidden("HiddenFieldBTFlag", "0")
@Html.Hidden("HiddenFielLocOnCreditHold", "0")
<!-- Hidden Field -->
@Html.Hidden("hdnAddeDocument", "Y")
@Html.Hidden("hdnEditeDocument", "Y")
@Html.Hidden("hdnDeleteDocument", "Y")
@Html.Hidden("hdnViewDocument", "Y")
@Html.Hidden("hdnIsAddPO", "0")
@Html.Hidden("hdnIsPostBack", "0")
@Html.Hidden("hdnIsCreateJob", "0")
@Html.Hidden("hdnQuickBooksIntegration", "0")

<input type="button" ID="btnRebindRadWindow" CausesValidation="false" style="display:none"/>

@Html.Hidden("hdnFocus")
@Html.Hidden("hdnReviewed")
@Html.Hidden("hdnProspect")
@Html.Hidden("hdnImg")
@Html.Hidden("hdnCon")
@Html.Hidden("hdnPatientId")
@Html.Hidden("hdnLocId")
@Html.Hidden("hdnUnitID")
@Html.Hidden("hdnProjectId")
@Html.Hidden("hdnRolID")
@Html.Hidden("hdnLang")
@Html.Hidden("hdnMultiLang")
@Html.Hidden("hdnFormId")
@Html.Hidden("hdnComp")
@Html.Hidden("hdnProjectCode")
@Html.Hidden("hdnSageInt")
@Html.Hidden("hdnProjectTaskCategory")
@*<%--inventory--%>*@
@Html.Hidden("hdnItemJSON")
<input type="button" ID="btnValidateLocation" Style="display: none;"
       CausesValidation="False" />


@*<%-------$$$$$$$$$$$$$$ RAD WINDOW $$$$$$$$$$$$$$$$-----%>*@



<script defer src="https://use.fontawesome.com/releases/v5.0.10/js/all.js"></script>
<!-- dropify -->
<script type="text/javascript" src="~/MOMUI/Design/js/plugins/dropify/js/dropify.min.js"></script>
@*<telerik:RadCodeBlock ID="RadCodeBlock21">*@
<script type="text/javascript">
    //Inventory
    function itemJSON() {
        debugger
        //var rawData = $("#RadGrid_Inventory").serializeFormJSON();
        //var formData = JSON.stringify(rawData);
        //$("#hdnItemJSON").val(formData);
    }
    //$(document).ready(function ()
    //{
    (function ($) {
        $.extend({
            toDictionary: function (query) {
                var parms = {};
                var items = query.split("&");
                for (var i = 0; i < items.length; i++) {
                    var values = items[i].split("=");
                    var key1 = decodeURIComponent(values.shift().replace(/\+/g, '%20'));
                    var key = key1.split('$')[key1.split('$').length - 1];
                    var value = values.join("=")
                    parms[key] = decodeURIComponent(value.replace(/\+/g, '%20'));
                }
                return (parms);
            }
        })
    })(jQuery);
    (function ($) {
        $.fn.serializeFormJSON = function () {
            var o = [];
            $(this).find('tr:not(:first, :last)').each(function () {
                var elements = $(this).find('input, textarea, select')
                if (elements.size() > 0) {
                    var serialized = $(this).find('input, textarea, select').serialize();
                    var item = $.toDictionary(serialized);
                    o.push(item);
                }
            });
            return o;
        };
    })(jQuery);
    function CalTotalVal(obj) {


        var txt = obj.id;

        var txtGvQuan;
        var txtGvPrice;
        var txtGvAmount;

        if (txt.indexOf("Quan") >= 0) {
            txtGvQuan = $(txt);
            txtGvPrice = $(txt.replace('txtGvQuan', 'txtGvPrice'));
            txtGvAmount = $(txt.replace('txtGvQuan', 'txtGvAmount'));
        }
        else if (txt.indexOf("Price") >= 0) {
            txtGvPrice = $(txt);
            txtGvQuan = $(txt.replace('txtGvPrice', 'txtGvQuan'));
            txtGvAmount = $(txt.replace('txtGvPrice', 'txtGvAmount'));
        }
        else if (txt.indexOf("Amount") >= 0) {
            txtGvPrice = $(txt.replace('txtGvAmount', 'txtGvPrice'));
            txtGvQuan = $(txt.replace('txtGvAmount', 'txtGvQuan'));
            txtGvAmount = $(txt);
        }

        if (!jQuery.trim($(txtGvQuan).val()) == "") {
            if (isNaN(parseFloat($(txtGvQuan).val()))) {
                $(txtGvQuan).val('0.00');
            }
        }

        if (!jQuery.trim($(txtGvPrice).val()) == "") {
            if (isNaN(parseFloat($(txtGvPrice).val()))) {
                $(txtGvPrice).val('0.00');
            }
        }

        if (!jQuery.trim($(txtGvQuan).val()) == "" && !jQuery.trim($(txtGvPrice).val()) == "") {
            if (!isNaN(parseFloat($(txtGvQuan).val())) && !isNaN(parseFloat($(txtGvPrice).val()))) {
                var valAmount = parseFloat($(txtGvQuan).val()) * parseFloat($(txtGvPrice).val());
                $(txtGvAmount).val(valAmount.toFixed(2));
            }
        }


        if (!isNaN(parseFloat($(obj.id).val()))) {
            $(obj.id).val(parseFloat($(obj.id).val()).toFixed(2));
        }
    }
    function dtaa() {
        this.prefixText = null;
        this.con = null;
        this.Acct = null;
    }
    //InitializeGrids("#RadGrid_Inventory");
    function InitializeGrids(Gridview) {

        var rowone = $("#" + Gridview).find('tr').eq(1);
        $("input", rowone).each(function () {
            $(this).blur();
        });
    }
    var totalQty = 0.00;
    $("[id*=txtGvQuan]").each(function () {
        if (!jQuery.trim($(this).val()) == "") {
            if (!isNaN(parseFloat($(this).val()))) {
                totalQty = totalQty + parseFloat($(this).val());
            } else
                $(this).val("");
        }
        else {
            $(this).val("");
        }
    });

    $('[id*=lblTotalQty]').text(totalQty.toFixed(2));


    /////  GET PHASE


    $("[id*=txtGvPhase]").autocomplete({

        source: function (request, response) {
            debugger
            var curr_control = $("[id*=txtGvPhase]").attr('id');
            var hdnProjectId = $("#hdnProjectId");
            var job = hdnProjectId.val();
            var prefixText = "Materials";

            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: "AccountAutoFill.asmx/GetPhase",
                data: '{"jobID": "' + job + '", "prefixText": "' + prefixText + '"}',
                dataType: "json",
                async: true,
                success: function (data) {
                    var phase = {};
                    var phase1 = [];
                    phase = $.parseJSON(data.d);
                    $.each(phase, function (index) {
                        if (phase[index].TypeName == "Materials") {
                            phase1[0] = phase[index];
                        }
                    });
                    var jsonConvertedData = JSON.stringify(phase1);
                    response($.parseJSON(jsonConvertedData));
                },
                error: function (result) {
                    alert("Due to unexpected errors we were unable to load type.");
                },
                complete: function () {
                    $(this).data('requestRunning', false);
                }
            });

        },
        deferRequestBy: 200,
        select: function (event, ui) {
            debugger;
            var txtGvPhase = this.id;
            var hdnTypeId = $(txtGvPhase.replace('txtGvPhase', 'hdnTypeId'));
            var hdntxtGvPhase = $(txtGvPhase.replace('txtGvPhase', 'hdntxtGvPhase'));
            var str = ui.item.TypeName;
            if (str == "No Record Found!") {
                $(this).val("");
            }
            else {

                $(hdnTypeId).val(ui.item.Type);
                console.log(hdnTypeId.val())
                $(this).val(ui.item.TypeName);
                $(hdntxtGvPhase).val(ui.item.TypeName);
                console.log(hdntxtGvPhase.val())

            }
            return false;
        },
        focus: function (event, ui) {

            $(this).val(ui.item.TypeName);

            return false;
        },
        minLength: 0,
        delay: 250
    }).click(function () {
        $(this).autocomplete('search', $(this).val())
    })
    $.each($(".phsearchinput"), function (index, item) {

        $(item).data("ui-autocomplete")._renderItem = function (ul, item) {
            var ula = ul;
            var itema = item;
            var result_value = item.Type;
            var result_item = item.TypeName;

            return $("<li></li>")
                .data("item.autocomplete", item)
                .append("<a>" + result_item + "</a>")
                .appendTo(ul);
        };
    });


    ///////////////  $$$$$$$$$$$$$$  INVETORY USED START $$$$$$$$$$$$$$$$$$$


    $("[id*=txtGvPhase]").change(function () {
        debugger
        var txtGvPhase = $(this);
        var strPhase = $(this).val();

        var txtGvPhase1 = $(txtGvPhase).attr('id');
        var hdnTypeId = $(txtGvPhase1.replace('txtGvPhase', 'hdnTypeId'));
        var hdnPID = $(txtGvPhase1.replace('txtGvPhase', 'hdnPID'));
        var txtGvItem = $(txtGvPhase1.replace('txtGvPhase', 'txtGvItem'));
        var hdnItemID = $(txtGvPhase1.replace('txtGvPhase', 'hdnItemID'));
        var txtGvDesc = $(txtGvPhase1.replace('txtGvPhase', 'txtGvDesc'));

        if (strPhase != "") {
            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: "AccountAutoFill.asmx/GetAutoFillPhase",
                data: '{"prefixText": "' + strPhase + '"}',
                dataType: "json",
                async: true,
                success: function (data) {
                    debugger
                    var ui = $.parseJSON(data.d);

                    if (ui.length == 0) {
                        $(txtGvPhase).val("");
                        $(hdnTypeId).val("");
                        $(hdnPID).val("");
                        $(txtGvItem).val("");
                        $(hdnItemID).val("");
                        noty({
                            text: 'Type \'' + strPhase + '\' doesn\'t exist!',
                            type: 'warning',
                            layout: 'topCenter',
                            closeOnSelfClick: false,
                            timeout: 5000,
                            theme: 'noty_theme_default',
                            closable: true
                        });
                    }
                    else {
                        var lbl = ui[0].Label;
                        var val = ui[0].Value;
                        $(txtGvPhase).val(lbl);
                        $(hdnTypeId).val(val);
                    }
                },
                error: function (result) {
                    alert("Due to unexpected errors we were unable to load Type");
                }
            });
        }
        else {
            $(hdnPID).val("");
            $(hdnTypeId).val("");
            $(txtGvItem).val("");
            $(hdnItemID).val("");
            $(txtGvDesc).val("");
        }
    });


    //Item
    $("[id*=txtGvItem]").change(function () {

        var txtGvItem = $(this);
        var strItem = $(this).val();

        var txtGvItem1 = $(txtGvItem).attr('id');
        var hdnTypeId = $(txtGvItem1.replace('txtGvItem', 'hdnTypeId'));
        var hdnPID = $(txtGvItem1.replace('txtGvItem', 'hdnPID'));
        var txtGvItem = $(txtGvItem1.replace('txtGvItem', 'txtGvItem'));
        var hdnItemID = $(txtGvItem1.replace('txtGvItem', 'hdnItemID'));
        var txtGvDesc = $(txtGvItem1.replace('txtGvItem', 'txtGvDesc'));
        var typeId = $(hdnTypeId).val();

        if (strItem != "") {

            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: "AccountAutoFill.asmx/GetPhaseExpByJobTypePO",

                data: '{"prefixText": "' + strItem + '", "typeId": "' + typeId + '", "job": "' + job + '"}',
                dataType: "json",
                async: true,
                success: function (data) {
                    var ui = $.parseJSON(data.d);
                    //debugger;
                    if (ui.length == 0) {

                        //$(txtGvItem).val("");
                        $(hdnItemID).val("");
                        $(hdnPID).val("");


                    }
                    else {
                        $(txtGvItem).val(ui[0].ItemDesc1);
                        $(hdnItemID).val(ui[0].ItemID);
                        $(hdnPID).val(ui[0].Line);
                        $(txtGvDesc).val(ui[0].fDesc);
                    }
                },
                error: function (result) {
                    alert("Due to unexpected errors we were unable to load Item");
                }
            });
        }
        else {
            $(hdnPID).val("");
            $(hdnItemID).val("");
        }
    });

    $("[id*=txtGvItem]").autocomplete({
        source: function (request, response) {
            var curr_control = this.element.attr('id');
            var job = "0";
            var typeId = "8";
            //var typeId = $(curr_control.replace('txtGvItem', 'hdnTypeId')).value;
            var prefixText = request.term;
            query = request.term;

            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: "AccountAutoFill.asmx/GetPhaseByInventoryItem",
                data: '{"typeId": "' + typeId + '", "jobId": "' + job + '", "prefixText": "' + prefixText + '"}',
                dataType: "json",
                async: true,
                success: function (data) {
                    var result = {};
                    var result1 = [];
                    result = $.parseJSON(data.d);
                    var i = 0;
                    $.each(result, function (index) {
                        if (result[index].INVtype == "0") {
                            result1[i] = result[index];
                            i = i + 1;
                        }
                    });
                    var jsonConvertedData = JSON.stringify(result1);
                    response($.parseJSON(jsonConvertedData));
                    //response($.parseJSON(data.d));
                },
                error: function (result) {
                    alert("Due to unexpected errors we were unable to load item.");
                },
                complete: function () {
                    $(this).data('requestRunning', false);
                }
            });

            return false;
        },
        deferRequestBy: 50,
        select: function (event, ui) {
            var curr_control = this.id;
            var hdnItemID = $(curr_control.replace('txtGvItem', 'hdnItemID'));
            var txtGvDesc = $(curr_control.replace('txtGvItem', 'txtGvDesc'));

            var txtGvWarehouse = $(curr_control.replace('txtGvItem', 'txtGvWarehouse'));
            var hdnWarehouseID = $(curr_control.replace('txtGvItem', 'hdnWarehouse'));

            var txtGvWarehouseLocation = $(curr_control.replace('txtGvItem', 'txtGvWarehouseLocation'));
            var hdnWarehouseLocationID = $(curr_control.replace('txtGvItem', 'hdnWarehouseLocationID'));

            $(txtGvWarehouse).val("");
            $(hdnWarehouseID).val("");
            $(txtGvWarehouseLocation).val("");
            $(hdnWarehouseLocationID).val("0");

            var hdnPID = $(curr_control.replace('txtGvItem', 'hdnPID'));
            var job = "";
            var str = ui.item.ItemDesc;
            var strId = ui.item.ItemID;


            if (strId == "0") {
                $(this).val("");
                $(hdnItemID).val("");
                $(hdnPID).val("");

            }
            else {
                if (ui.item.ItemID) {
                    var result = $(this);
                    if (ui.item.OnHand > 0) {
                        $(txtGvDesc).val(ui.item.fDesc);
                        $(hdnItemID).val(ui.item.ItemID);
                        $(hdnPID).val(ui.item.Line);
                        $(this).val(ui.item.ItemDesc1);

                        var txtGvPrice = $(result[0].id.replace('txtGvItem', 'txtGvPrice'));
                        $(txtGvPrice).val(parseFloat(ui.item.Price).toFixed(2));
                        // Get warehouse
                        var dtaaa = new dtaa();
                        dtaaa.prefixText = "";
                        dtaaa.InvID = ui.item.ItemID;
                        dtaaa.isShowAll = "no";
                        $.ajax({
                            type: "POST",
                            contentType: "application/json; charset=utf-8",
                            url: "AccountAutoFill.asmx/GetWarehouseName",
                            data: JSON.stringify(dtaaa),
                            dataType: "json",
                            async: true,
                            success: function (data) {
                                var warehouse = $.parseJSON(data.d);
                                if (warehouse != null && warehouse.length == 1) {
                                    $(txtGvWarehouse).val(warehouse[0]["WarehouseName"]);
                                    $(hdnWarehouseID).val(warehouse[0]["WarehouseID"]);
                                }
                            },
                            error: function (result) {
                                // alert("Due to unexpected errors we were unable to load account name");
                            }
                        });
                    } else {
                        alert("Item selected is not on hand, please choose another one.");
                        $(hdnItemID).val("");
                        $(result).val("");
                        $(txtGvDesc).val("");
                    }
                }
                else {
                    $(this).val("");
                    $(hdnPID).val(ui.item.Line);
                    $(txtGvDesc).val(ui.item.ItemDesc1);
                }

            }
            return false;
        },
        focus: function (event, ui) {
            if (ui.item) {
                $(this).val(ui.item.ItemDesc1);
            }
            return false;
        },

        minLength: 0,
        delay: 250
    }).click(function () {
        $(this).autocomplete('search', $(this).val())
    })
    $.each($(".pisearchinput"), function (index, item) {

        $(item).data("ui-autocomplete")._renderItem = function (ul, item) {
            var ula = ul;
            var itema = item;
            var result_value = item.ItemID;
            var result_item = item.ItemDesc1;
            var result_line = item.Line;
            var result_itemfdesc = item.fDesc;
            var OnHand = item.OnHand;


            var x = new RegExp('\\b' + query, 'ig');

            try {



                if (result_item != null) {

                    result_item = result_item.replace(x, function (FullMatch, n) {
                        return '<span class="highlight">' + FullMatch + '</span>'
                    });

                }

                if (result_itemfdesc != null) {

                    result_itemfdesc = result_itemfdesc.replace(x, function (FullMatch, n) {
                        return '<span class="highlight">' + FullMatch + '</span>'
                    });

                }

            } catch{ }

            if (result_line == "0") {
                return $("<li></li>")
                    .data("item.autocomplete", item)
                    .append("<a>  " + result_item + ', Qty :' + OnHand + ", <span style='color:Gray;'><b>  </b>" + result_itemfdesc + "</span></a>")
                    .appendTo(ul);
            }
            else {

                if (result_item == undefined) { result_item = 'No Record Found!'; }
                return $("<li></li>")
                    .data("item.autocomplete", item)
                    .append("<span class='auto_item'><i style='display:inline-block; margin-right:8px;width:auto;color:#1565C0 !important;' class='fas fa-check-square' title=''></i>" + result_item + "</span>")
                    .appendTo(ul);

            }
        };
    });
    //warehouse

    //txtGvWarehouse
    $("[id*=txtGvWarehouse]").autocomplete({
        source: function (request, response) {
            //debugger;
            var dtaaa = new dtaa();
            dtaaa.prefixText = request.term;
            query = request.term;

            var str = request.term;

            var txtGvWarehouse_GetID = $(this.element).attr("id");
            var hdnInvID = $(txtGvWarehouse_GetID.replace('txtGvWarehouse', 'hdnItemID'));

            var hdntxtGvPhase = $(txtGvWarehouse_GetID.replace('txtGvWarehouse', 'hdntxtGvPhase'));
            //  if (hdntxtGvPhase.value != "Inventory") { return; }
            console.log(hdntxtGvPhase.val());

            var ID = $(hdnInvID).val();


            dtaaa.InvID = ID;
            dtaaa.isShowAll = "no";
            //debugger;
            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: "AccountAutoFill.asmx/GetWarehouseName",
                data: JSON.stringify(dtaaa),
                dataType: "json",
                async: true,
                success: function (data) {
                    response($.parseJSON(data.d));
                },
                error: function (result) {
                    // alert("Due to unexpected errors we were unable to load account name");
                }
            });
        },
        select: function (event, ui) {
            try {
                var txtGvWarehouse = this.id;
                var hdnWarehouse = $(txtGvWarehouse.replace('txtGvWarehouse', 'hdnWarehouse'));
                var hdnInvID = $(txtGvWarehouse.replace('txtGvWarehouse', 'hdnItemID'));



                var txtGvWarehouseLocation = $(txtGvWarehouse.replace('txtGvWarehouse', 'txtGvWarehouseLocation'));
                var hdnWarehouseLocationID = $(txtGvWarehouse.replace('txtGvWarehouse', 'hdnWarehouseLocationID'));

                $(txtGvWarehouseLocation).val("");
                $(hdnWarehouseLocationID).val("0");


                var Str = ui.item.WarehouseID + ", " + ui.item.WarehouseName;
                //$(this).val(Str);
                //$(txtGvWarehouse).val(Str);
                $(this).val(ui.item.WarehouseName);
                $(txtGvWarehouse).val(ui.item.WarehouseName);
                $(hdnWarehouse).val(ui.item.WarehouseID);

                var locationID = 0;
                var warehouseID = $(hdnWarehouse).val();
                var invID = $(hdnInvID).val();

                //// Check ON Hand
                $.ajax({
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: "AccountAutoFill.asmx/IsItemOnHand",
                    data: '{"INVitemID": "' + invID + '","WareHouseID": "' + ui.item.WarehouseID + '","WHLocationID": "0"}',
                    dataType: "json",
                    async: true,
                    success: function (data) {
                        if (data.d == "false") {
                            alert("Item selected is not on hand this warehouse, please choose another one.");
                            $(txtGvWarehouse).val("");
                            $(hdnWarehouse).val("");
                        }
                    },
                    error: function (result) {
                        // alert("Due to unexpected errors we were unable to load item.");
                    },

                });

                ////

            } catch{ }
            return false;
        },
        focus: function (event, ui) {
            try {
                //$(this).val(ui.item.WarehouseID);
                $(this).val(ui.item.WarehouseName);
            } catch{ }
            return false;
        },
        minLength: 0,
        delay: 250
    }).click(function () {
        $(this).autocomplete('search', $(this).val())
    });
    $.each($(".Warehousesearchinput"), function (index, item) {

        if (item && typeof item == "object")
            $(item).data("ui-autocomplete")._renderItem = function (ul, item) {
                debugger;
                var ula = ul;
                var itema = item;
                var result_value = item.ID;
                var result_item = item.WarehouseName;
                var result_desc = item.WarehouseID;
                var x = new RegExp('\\b' + query, 'ig'); // notice the escape \ here...
                result_item = result_item.replace(x, function (FullMatch, n) {
                    return '<span class="highlight">' + FullMatch + '</span>'
                });
                if (result_desc != null) {
                    result_desc = result_desc.replace(x, function (FullMatch, n) {
                        return '<span class="highlight">' + FullMatch + '</span>'
                    });
                }

                if (result_value == 0) {
                    return $("<li></li>")
                        .data("item.autocomplete", item)
                        .append("<a>" + result_item + "</a>")
                        .appendTo(ul);
                }
                else {
                    return $("<li></li>")
                        .data("item.autocomplete", item)
                        .append("<a style='color:blue;'>" + result_item + "</a>")
                        .appendTo(ul);
                }
            };
    });
    //warehouselocation

    //txtGvWarehouseLocation
    $("[id*=txtGvWarehouseLocation]").autocomplete({


        source: function (request, response) {

            debugger;
            var dtaaa = new dtaa();
            dtaaa.prefixText = request.term;
            query = request.term;
            var str = request.term;

            var txtGvWarehouseLocation_GetID = $(this.element).attr("id");
            var hdnWarehouse = $(txtGvWarehouseLocation_GetID.replace('txtGvWarehouseLocation', 'hdnWarehouse'));
            var ID = $(hdnWarehouse).val();
            var hdntxtGvPhase = $(txtGvWarehouseLocation_GetID.replace('txtGvWarehouseLocation', 'hdntxtGvPhase'));
            dtaaa.WarehouseID = ID;

            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: "AccountAutoFill.asmx/GetWarehouseLocation",
                data: JSON.stringify(dtaaa),
                dataType: "json",
                async: true,
                success: function (data) {

                    response($.parseJSON(data.d));

                },
                error: function (result) {
                    alert("Due to unexpected errors we were unable to load account name");
                }
            });
        },
        select: function (event, ui) {
            try {
                var txtGvWarehouseLocation = this.id;
                var hdnWarehouseLocationID = $(txtGvWarehouseLocation.replace('txtGvWarehouseLocation', 'hdnWarehouseLocationID'));
                var hdnInvID = $(txtGvWarehouseLocation.replace('txtGvWarehouseLocation', 'hdnItemID'));
                var hdnWarehouse = $(txtGvWarehouseLocation.replace('txtGvWarehouseLocation', 'hdnWarehouse'));

                var Str = ui.item.ID + ", " + ui.item.Name;
                $(this).val(Str);
                $(txtGvWarehouseLocation).val(Str);
                $(hdnWarehouseLocationID).val(ui.item.ID);

                var locationID = $(hdnWarehouseLocationID).val();
                // alert(ui.item.ID);
                var warehouseID = $(hdnWarehouse).val();
                var invID = $(hdnInvID).val();


                //// Check ON Hand
                $.ajax({
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: "AccountAutoFill.asmx/IsItemOnHand",
                    data: '{"INVitemID": "' + invID + '","WareHouseID": "' + warehouseID + '","WHLocationID": "' + ui.item.ID + '"}',
                    dataType: "json",
                    async: true,
                    success: function (data) {
                        if (data.d == "false") {
                            alert("Item selected is not on hand this location, please choose another one.");
                            $(txtGvWarehouseLocation).val("");
                            $(hdnWarehouseLocationID).val("");
                        }
                    },
                    error: function (result) {
                        alert("Due to unexpected errors we were unable to load item.");
                    },

                });

                ////


            } catch{ }

            return false;
        },
        focus: function (event, ui) {
            try {
                $(this).val(ui.item.ID);
            } catch{ }
            return false;
        },
        minLength: 0,
        delay: 250
    }).click(function () {
        $(this).autocomplete('search', $(this).val())
    })
    $.each($(".WarehouseLocationsearchinput"), function (index, item) {
        $(item).data("ui-autocomplete")._renderItem = function (ul, item) {
            debugger;
            var ula = ul;
            var itema = item;
            var result_value = item.ID;
            var result_item = item.Name;

            var x = new RegExp('\\b' + query, 'ig'); // notice the escape \ here...
            result_item = result_item.replace(x, function (FullMatch, n) {
                return '<span class="highlight">' + FullMatch + '</span>'
            });


            if (result_value == 0) {
                return $("<li></li>")
                    .data("item.autocomplete", item)
                    .append("<a>" + result_item + "</a>")
                    .appendTo(ul);
            }
            else {
                return $("<li></li>")
                    .data("item.autocomplete", item)
                    .append("<a style='color:blue;'>" + result_item + "</a>")
                    .appendTo(ul);
            }
        };
    });




    function isDecimalKey(el, evt) {
        var charCode = (evt.which) ? evt.which : event.keyCode;
        if (charCode == 45) {
            return true;
        }
        var number = el.value.split('.');
        if (charCode != 46 && charCode > 31 && (charCode < 48 || charCode > 57)) {
            return false;
        }
        if (number.length > 1 && charCode == 46) {
            return false;
        }
        var caratPos = getSelectionStart(el);
        var dotPos = el.value.indexOf(".");
        if (caratPos > dotPos && dotPos > -1 && (number[1].length > 1)) {
            return false;
        }
        return true;
    }

    function getSelectionStart(o) {
        if (o.createTextRange) {
            var r = document.selection.createRange().duplicate()
            r.moveEnd('character', o.value.length)
            if (r.text == "") return o.value.length
            return o.value.lastIndexOf(r.text)
        } else return o.selectionStart
    }





    //})
    //end inventory

    ///////////////  $$$$$$$$$$$$$$  INVETORY USED $$$$$$$$$$$$$$$$$$$


    function HideME() {
        $("#DivEqup").hide();
        $("#DivprojectType").hide();
        $("#DivProject").hide();
    }


    $(document).ready(function () {




        $("#phone-demo").mask("(999) 999-9999? Ext 99999");
        $("#phone-demo").bind('paste', function () { $(this).val(""); });
        $("#phone_cell").mask("(999) 999-9999");
        $("#phone_fax").mask("(999) 999-9999");
        $("#calledinTime").mask("99:99 aa")
        $("#Time").mask("99:99 aa")
        $("#EnrouteTime").mask("99:99 aa")
        $("#OnsiteTime").mask("99:99 aa")
        $("#CompletedTime").mask("99:99 aa")

        $('a[href^="#accrd"]').on('click', function (e) {
            e.preventDefault();
            $("a.anchorActive").removeClass("anchorActive");
            $(this).addClass("anchorActive");
            var target = this.hash;
            var $target = $(target);
            if ($(target).hasClass('active') || target == "") {

            }
            else {
                $(target).click();
            }

            $('html, body').stop().animate({
                'scrollTop': $target.offset().top - 125
            }, 900, 'swing');
        });

        $('#addinfo').hide();
        $('.add-btn-click').click(function () {
            if (document.getElementsByClassName("add-btn-click")[0].innerHTML.indexOf("Show") != -1)
                document.getElementsByClassName("add-btn-click")[0].innerHTML = "Hide Stats";
            else
                document.getElementsByClassName("add-btn-click")[0].innerHTML = "Show Stats";


            $('#addinfo').slideToggle('2000', "swing", function () {
                // Animation complete.

            });

            if ($('.divbutton-container').height() != 65)
                $('.divbutton-container').animate({ height: 65 }, 500);
            else
                $('.divbutton-container').animate({ height: 350 }, 500);


        });

        $(window).scroll(function () {
            if ($(window).scrollTop() >= 0) {
                $('#divButtons').addClass('fixed-header');
            }
            if ($(window).scrollTop() <= 0) {
                $('#divButtons').removeClass('fixed-header');
            }
        });


        function collapseAll() {
            $(".accrd").removeClass(function () {
                return "active";
            });
            $('html, body').stop().animate({
                'scrollTop': 0
            }, 300, 'swing');
            $(".collapsible-accordion").collapsible({ accordion: true });
            $(".collapsible-accordion").collapsible({ accordion: false });

        }

        function expandAll() {
            $('html, body').stop().animate({
                'scrollTop': 0
            }, 300, 'swing');
            $(".accrd").addClass("active");
            $(".collapsible-accordion").collapsible({ accordion: false });
        }

        $('.collapse-expand').on('click', function (e) {
            if (this.classList.contains("opened") === true) {
                this.classList.remove("opened");
                this.innerHTML.replace(/mdi-action-open-in-browser/g, 'mdi-action-system-update-tv')
                collapseAll();
            }
            else {
                this.classList.add("is-active");
                this.classList.add("opened");
                this.innerHTML.replace(/mdi-action-system-update-tv/g, 'mdi-action-open-in-browser')
                expandAll();
            }
        });

        //Dropify Basic
        $('.dropify').dropify();
        // Used events
        var drEvent = $('.dropify-event').dropify();

        drEvent.on('dropify.beforeClear', function (event, element) {
            return confirm("Do you really want to delete \"" + element.filename + "\" ?");
        });

        drEvent.on('dropify.afterClear', function (event, element) {
            alert('File deleted');
        });
    });
</script>

<script>

    function initialize() {
        var address = new google.maps.LatLng($("# lat").val(), $("# lng").val());
        var marker;
        var map;
        var mapOptions = {
            zoom: 13,
            mapTypeId: google.maps.MapTypeId.ROADMAP,
            center: address
        };

        map = new google.maps.Map($('map'),
            mapOptions);

        marker = new google.maps.Marker({
            map: map,
            draggable: false,
            position: address
        });

        if ($("# hdnComp").val() != "2" && $("# hdnComp").val() != "1") {
            CallNearestWorker();
        }
    }

    function InitMap(lat, lng) {
        var address = new google.maps.LatLng(lat, lng);
        var marker;
        var map;
        var mapOptions = {
            zoom: 13,
            mapTypeId: google.maps.MapTypeId.ROADMAP,
            center: address
        };

        map = new google.maps.Map($('map'),
            mapOptions);

        marker = new google.maps.Marker({
            map: map,
            draggable: false,
            position: address
        });
    }






    function SelectRowsEq() {

        var Name = $("#txtUnit");
        var div = $('eqtag');
        div.innerHTML = "";
        Name.val("");
        // debugger;

        var grid = $find("#RadgvEquip");
        var masterTable = grid.get_masterTableView();
        if (masterTable != null) {
            for (var i = 0; i < masterTable.get_dataItems().length; i++) {
                var gridItemElement = masterTable.get_dataItems()[i].findElement("chkSelect");
                var lblUnit = masterTable.get_dataItems()[i].findElement("lblUnit");
                var lblID = masterTable.get_dataItems()[i].findElement("lblID");
                if (gridItemElement.checked) {
                    if (Name.val() != "") {
                        Name.val(Name.val() + ', ' + lblUnit.innerHTML);
                    }
                    else {
                        Name.val(lblUnit.innerHTML);
                    }

                    var tag = "<div class='chip' style='width:auto !important;padding-left:5px !important;padding-right:5px !important ;margin-left:2px !important ;margin-right:2px !important ;margin-top:3px !important ;'><a href='addequipment.aspx?uid=" + lblID.innerHTML + "' target='_blank' style='color:white'>" + lblUnit.innerHTML + "</a></div>"

                    div.innerHTML += tag;
                }
            }
        }
    }


    function EqCheckBOX(checked) {

        // debugger;

        var grid = $find("#RadgvEquip");
        var masterTable = grid.get_masterTableView();
        if (masterTable != null) {
            for (var i = 0; i < masterTable.get_dataItems().length; i++) {
                var gridItemElement = masterTable.get_dataItems()[i].findElement("chkSelect");
                var lblUnit = masterTable.get_dataItems()[i].findElement("lblUnit");
                gridItemElement.checked = checked;
            }
        }
    }




    ////////////////////Project \\\\\\\\\\\\\\\\\\\\\\\\\


    function SelectProjectRow(gridview, id, name, chargeable, hdnProjectId, txtProject, projectNo, div) {
        debugger;
        var rowid = $(id);
        var rowname = $(name);
        var rowChargeable = $(chargeable);
        var grid = $(gridview);
        var hidden = $(hdnProjectId);
        var hdnName = $(txtProject);
        var projectNo = $(projectNo);

        $("#hdnIsJobChargable").val(rowChargeable.innerHTML);

        ///Check if the job is charge then check chargeable boxes
        if (rowChargeable.innerHTML == '1') {
            var chkChargeable = $("#chkChargeable");
            var chkJobChargeable = $("#chkJobChargeable");
            chkChargeable.css('checked', true);
            chkJobChargeable.css('checked', true);
        }


        hdnName.val(rowid.innerHTML + ' ' + rowname.innerHTML);
        hidden.val(rowid.innerHTML);
        projectNo.val(rowid.innerHTML + ' ' + rowname.innerHTML);

        $("#DivProject").hide();

        Materialize.updateTextFields();

    }

    function SelectProjectTypeRow(gridview, id, name, hdnProjectCode, txtJobCode, projectNo, div) {

        var rowid = $(id);
        var rowname = $(name);

        var hidden = $(hdnProjectCode);
        var hdnName = $(txtJobCode);


        hdnName.val(rowname.innerHTML);
        hidden.val(rowid.innerHTML);


        $("#DivprojectType").hide();

        Materialize.updateTextFields();
    }


    function lblRelatedTickets_Client() {
        var wo = $("#txtWO");
        if (wo.val() == "") {
            noty({ text: 'Please enter WO', type: 'warning', layout: 'topCenter', closeOnSelfClick: true, timeout: 5000, theme: 'noty_theme_default', closable: false, dismissQueue: true });
        }
    }




</script>

@*</telerik:RadCodeBlock>*@

<script type="text/javascript">



    function pageLoad(sender, args) {


        ///////////// Calculate total time fields handling (KEYUP) ////////////////////


        $("#txtOT").keyup(function (event) {
            calculateTotalTime();
        });

        $("#txtNT").keyup(function (event) {
            calculateTotalTime();
        });

        $("#txtDT").keyup(function (event) {
            calculateTotalTime();
        });

        $("#txtTT").keyup(function (event) {
            calculateTotalTime();
        });

        $("#txtBT").keyup(function (event) {
            DeductedValue(true);
        });



        /////////// Calculate total time fields handling (BLUR)  ////////////////////
        $("#txtRT").blur(function (event) {
            debugger;
            if (this.value == "") {
                this.value = '0.00';
            } calculateTotalTime();
        });
        $("#txtRT").keyup(function (event) {
            debugger;
            calculateTotalTime();
        });
        $("#txtOT").blur(function (event) {
            if (this.value == "") {
                this.value = '0.00';
            } calculateTotalTime();
        });

        $("#txtNT").blur(function (event) {
            if (this.value == "") {
                this.value = '0.00';
            } calculateTotalTime();
        });

        $("#txtDT").blur(function (event) {
            if (this.value == "") {
                this.value = '0.00';
            } calculateTotalTime();
        });

        $("#txtTT").blur(function (event) {
            if (this.value == "") {
                this.value = '0.00';
            } calculateTotalTime();
        });

        $("#txtBT").blur(function (event) {
            if (this.value == "") {
                this.value = '0.00';
            } DeductedValue(true);
        });



        ///////////// Calculate time fields handling (KEYUP)  ////////////////////
        $("#txtEnrTime").keyup(function (event) {
            calculate_Time();
        });

        $("#txtOnsitetime").keyup(function (event) {
            calculate_Time();
        });

        $("#txtComplTime").keyup(function (event) {
            calculate_Time();
        });

        ///////////// Calculate time fields handling (BLUR)  ////////////////////
        //            $("#txtEnrTime").blur(function(event) {
        //                calculate_Time();
        //            });

        //            $("#txtOnsitetime").blur(function(event) {
        //                calculate_Time();
        //            });

        //            $("#txtComplTime").blur(function(event) {
        //                calculate_Time();
        //            });


        ///////////// Calculate Mileage (KEYUP) ////////////////////
        $("#txtMileStart").keyup(function (event) {
            calculateMileage();
        });

        $("#txtMileEnd").keyup(function (event) {
            calculateMileage();
        });

        ///////////// Calculate Mileage (BLUR) ////////////////////
        $("#txtMileStart").blur(function (event) {
            calculateMileage();
        });

        $("#txtMileEnd").blur(function (event) {
            calculateMileage();
        });
        ///////////// Calculate Expenses (KEYUP) ////////////////////
        $("#txtExpMisc").keyup(function (event) {
            calculateMileage();
        });

        $("#txtExpToll").keyup(function (event) {
            calculateMileage();
        });

        $("#txtExpZone").keyup(function (event) {
            calculateMileage();
        });

        ///////////// Calculate Expenses (BLUR) ////////////////////
        $("#txtExpMisc").blur(function (event) {
            calculateMileage();
        });

        $("#txtExpToll").blur(function (event) {
            calculateMileage();
        });

        $("#txtExpZone").blur(function (event) {
            calculateMileage();
        });

        $("#txtRemarks").focus(function () {
            var height = $(this)[0].scrollHeight;
            if (height != null && height > 12) {
                $(this).animate({
                    //right: "+=0",
                    //width: '520px',
                    height: height - 12
                }, 500, function () {
                    // Animation complete.
                });
            }
        });

        $("#txtRemarks").blur(function () {
            $(this).animate({
                width: '100%',
                height: '63px'
            }, 500, function () {
                // Animation complete.
            });
        });

        $("#txtReason").focus(function () {
            $(this).animate({
                width: '520px',
                height: '+=150px'
            }, 500, function () {
                // Animation complete.
            });

            //$(this).zIndex(1);
        });

        $("#txtReason").blur(function () {
            $(this).animate({
                width: '100%'
                , height: '63px'
            }, 500, function () {
                // Animation complete.
            });
            // $(this).zIndex(0);
        });

        ////////////////////////



        Materialize.updateTextFields();

        SelectRowsEq();


        $("#lnkConvert").click(function () {

            var window = $find("#RadWindowLead");
            window.show();

        });

        $("#ddlCategory").change(function () {
            CategoryImage();
        });
        CategoryImage();




        ///////////// Ajax call for customer auto search ////////////////////
        var query = "";
        function dtaa() {
            this.prefixText = null;
            this.con = $("#hdnCon").val();
            this.custID = null;
        }

        $("#txtCustomer").autocomplete({

            open: function (e, ui) {
                /* create the scrollbar each time autocomplete menu opens/updates */
                $(".ui-autocomplete").mCustomScrollbar({
                    setHeight: 182,
                    theme: "dark-3",
                    autoExpandScrollbar: true
                });
            },
            response: function (e, ui) {
                /* destroy the scrollbar after each search completes, before the menu is shown */
                $(".ui-autocomplete").mCustomScrollbar("destroy");
            },

            source: function (request, response) {


                var dtaaa = new dtaa();
                dtaaa.prefixText = request.term;
                query = request.term;
                $.ajax({
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: "CustomerAuto.asmx/GetCustomerProspect",
                    //data: '{"prefixText":' + JSON.stringify(request.term) + ',"con":' + JSON.stringify($('ctl00_ContentPlaceHolder1_hdnCon').value) + '}',
                    data: JSON.stringify(dtaaa),
                    dataType: "json",
                    async: true,
                    success: function (data) {
                        response($.parseJSON(data.d));
                    },
                    //                        error: function(result) {
                    //                            alert("Due to unexpected errors we were unable to load customers");
                    //                        }
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        var err = eval("(" + XMLHttpRequest.responseText + ")");
                        alert(err.Message);
                    }
                });

            },
            select: function (event, ui) {
                $("#txtCustomer").val(ui.item.label);
                if (ui.item.prospect == 1) {
                    $("#txtLocation").val("");
                    $("#hdnLocId").val(ui.item.value);
                    $("#txtLocation").attr("disabled", "disabled");
                    $("#hdnProspect").val('1');
                    $("#btnSelectLoc").click();
                }
                else {
                    $("#hdnPatientId").val(ui.item.value);
                    $("#txtLocation").focus();
                    $("#txtLocation").val("");
                    $("#hdnLocId").val("");
                    $("#hdnProspect").val("");
                    $("#btnSelectCustomer").click();

                }
                return false;
            },
            focus: function (event, ui) {
                // $("#txtCustomer").val(ui.item.label);
                return false;
            },
            minLength: 0,
            delay: 50
        })


            .data("ui-autocomplete")._renderItem = function (ul, item) {
                try {
                    var result_item = item.label;
                    var result_desc = item.desc;
                    var result_Prospect = item.prospect;
                    var x = new RegExp('\\b' + query, 'ig'); // notice the escape \ here...


                    if (query != "") {

                        result_item = result_item.replace(x, function (FullMatch, n) {
                            return '<span class="highlight">' + FullMatch + '</span>'
                        });

                        if (result_desc != null) {
                            result_desc = result_desc.replace(x, function (FullMatch, n) {
                                return '<span class="highlight">' + FullMatch + '</span>'
                            });
                        }
                    }
                    var color = '#222';
                    if (result_Prospect != 0) {
                        display = "inline-block";
                    }
                    else {
                        display = "none";
                    }
                    return $("<li></li>")
                        .data("item.autocomplete", item)
                        .append("<span class='auto_item'><i style='display:" + display + ";margin-right:8px;width:auto;color:#1565C0 !important;' class='fas fa-thumbs-up' title='Prospect'></i>" + result_item + "</span> <span class='auto_desc'>" + result_desc + "</span>")
                        .appendTo(ul);
                } catch{ }
            };


        ///////////// Ajax call for location auto search ////////////////////
        var queryloc = "";
        $("#txtLocation").autocomplete(
            {

                open: function (e, ui) {
                    /* create the scrollbar each time autocomplete menu opens/updates */
                    $(".ui-autocomplete").mCustomScrollbar({
                        setHeight: 182,
                        theme: "dark-3",
                        autoExpandScrollbar: true
                    });
                },
                response: function (e, ui) {
                    /* destroy the scrollbar after each search completes, before the menu is shown */
                    $(".ui-autocomplete").mCustomScrollbar("destroy");
                },
                source: function (request, response) {
                    //                        if ($('ctl00_ContentPlaceHolder1_hdnPatientId').value != "") {
                    var dtaaa = new dtaa();
                    dtaaa.prefixText = request.term;
                    dtaaa.custID = 0;
                    if ($("#hdnPatientId").val() != "") {
                        dtaaa.custID = $("#hdnPatientId").val();
                    }
                    queryloc = request.term;
                    $.ajax({
                        type: "POST",
                        contentType: "application/json; charset=utf-8",
                        url: "CustomerAuto.asmx/GetLocation",

                        data: JSON.stringify(dtaaa),
                        dataType: "json",
                        async: true,
                        success: function (data) {
                            response($.parseJSON(data.d));
                        },
                        error: function (result) {
                            alert("Due to unexpected errors we were unable to load customers");
                        }

                    });


                },
                select: function (event, ui) {
                    $("#txtLocation").val(ui.item.label);
                    $("#hdnLocId").val(ui.item.value);
                    $("#btnSelectLoc").click();
                    return false;
                },
                focus: function (event, ui) {
                    //  $("#txtLocation").val(ui.item.label);
                    return false;
                },
                minLength: 0,
                delay: 10
            })
            .data("ui-autocomplete")._renderItem = function (ul, item) {
                try {
                    var result_item = item.label;
                    var result_desc = item.desc;
                    var x = new RegExp('\\b' + queryloc, 'ig'); // notice the escape \ here...

                    if (queryloc != "") {

                        result_item = result_item.replace(x, function (FullMatch, n) {
                            return '<span class="highlight">' + FullMatch + '</span>'
                        });

                        if (result_desc != null) {
                            result_desc = result_desc.replace(x, function (FullMatch, n) {
                                return '<span class="highlight">' + FullMatch + '</span>'
                            });
                        }
                    }



                    return $("<li></li>")
                        .data("item.autocomplete", item)
                        .append("<span class='auto_item'>" + result_item + "</span> <span class='auto_desc'>" + result_desc + "</span>")
                        .appendTo(ul);
                } catch{ }
            };


        ////////////MAP///////////
        $("#mapLink").click(function () {
            $("#map").toggle();
            $("#Coord").toggle();
            initialize();
        });


        initialize();



        ////////MAP/////



        ////////////////Project \\\\\\\\\\\\\\\\\

        ///////////// Validations for auto search ////////////////////

        $("#txtCustomer").keyup(function (e) {
            var hdnPatientId = $("#hdnPatientId");
            var txtLoc = $("#txtLocation");
            var txtCust = $("#txtCustomer");
            var hdnLocID = $("#hdnLocId");

            if ((e.which >= 46 && e.which <= 90) || (e.which >= 96 && e.which <= 105) || (e.which >= 186 && e.which <= 222) || e.which == 8) {
                hdnPatientId.val("");
                hdnLocID.val("");
                $("#lnkCustomerID").removeAttr("href");
            }

            if ($("#txtCustomer").val() == "") {
                hdnPatientId.val("");
                $("#lnkLocationID").removeAttr("href");
            }
        });

        $("#txtCustomer").blur(function (e) {
            CheckIsProspect();
        });

        $("#txtLocation").keyup(function (event) {
            var hdnLocId = $("#hdnLocId");
            if ($("#txtLocation").val() == "") {
                hdnLocId.val("");
                $("#lnkLocationID").removeAttr("href");
            }
        });


        ///////////// Unit dropdown control handling ////////////////////
        $("#txtUnit").keyup(function (event) {
            var hdnUnitId = $("#hdnUnitID");
            if ($("#txtUnit").val() == "") {
                hdnUnitId.val("");
            }
        });

        $("#txtProject").keyup(function (event) {
            var hdnProjectId = $("#hdnProjectId");
            if ($("#txtProject").val() == "") {
                hdnProjectId.val("");
                $("#lnkProjectID").removeAttr("href");
                $("#ddlTemplate").prop('disabled', false);

            }

        });



        $("#txtJobCode").keyup(function (event) {
            var hdnProjectCode = $("#hdnProjectCode");
            if ($("#txtJobCode").val() == "") {
                hdnProjectCode.val("");
            }
        });







        ////////Grid Equipment checkbox Check\\\\\


        $("#RadgvEquip input[id*='chkAll']:checkbox").click(function () {
            //  debugger;
            if ($(this).is(':checked')) {


                EqCheckBOX(true);

            }
            else {


                EqCheckBOX(false);
            }

            SelectRowsEq();

        });
        $("#chkCreateMultipleTicket").click(function () {
            $("#btnchkCreateMultipleTicket").click();
        });



        ///////////// Signature box handling  ////////////////////


        $("#signbg").click(function () {
            if (isCanvasSupported()) {
                //$("#sign").toggle();
                //$("#sign").focus();

                var window = $find("#RadWindow1Signature");
                window.show();
            }
            else {
                alert('Signature not supported on this web browser.');
            }
        });

        $("#sign").blur(function () {
            //$("#sign").hide();

        });


        $("#convertpngbtn").click(function () {
            // $("#sign").hide();

            toImage();
        });


        $("#eqtag").click(function () {

            $("#DivEqup").show();
        });

        $("#txtJobCode").click(function () {

            $("#DivprojectType").show();

        });

        $("#txtProject").click(function toggleProject() {

            $("#DivProject").show();

        });

        var grid = $find("#RadgvEquip");
        var masterTable = grid.get_masterTableView();
        if (masterTable != null) {

            var columns = grid.get_masterTableView().get_columns();
            for (var i = 0; i < columns.length; i++) {
                columns[i].resizeToFit(false, true);
            }
        }




        $(function () {
            $("#txtGoogleAutoc").geocomplete({
                map: false,
                details: "#divmain",
                types: ["geocode", "establishment"],
                address_components: "#txtGoogleAutoc",
                city: "#txtCity",
                state: "#ddlState",
                zip: "#txtZip",
                lat: "#lat",
                lng: "#lng"
            }).bind("geocode:result", function (event, result) {

                //var getCountry = "";
                //for (var i = 0; i < result.address_components.length; i++) {
                //    var addr = result.address_components[i];
                //    var getCountry;
                //    if (addr.types[0] == 'country')
                //        getCountry = addr.short_name;
                //}
                var countryCode = "", city = "", cityAlt = "", getCountry = "";
                for (var i = 0; i < result.address_components.length; i++) {

                    var addr = result.address_components[i];

                    if (addr.types[0] == 'country')
                        getCountry = addr.short_name;
                    if (addr.types[0] == 'locality')
                        city = addr.long_name;
                    if (addr.types[0] == 'administrative_area_level_1')
                        cityAlt = addr.short_name;
                    if (addr.types[0] == 'postal_code')
                        countryCode = addr.long_name;
                }
                if (cityAlt.length > 2)
                    for (var i = 0; i < result.address_components.length; i++) {
                        var addr = result.address_components[i];
                        if (addr.types[0] == 'administrative_area_level_2')
                            cityAlt = addr.short_name;
                    }
                $("#txtCountry").val(getCountry);
                $("#txtCity").val(city);
                $("#txtZip").val(countryCode);
                $("#ddlState").val(cityAlt);

                Materialize.updateTextFields();

            });
        });

        Materialize.updateTextFields();
        $("#ddlStatus").change(function () {
            $("#lnkddlStatus").click();
        });

    }

    function JobChargeableCheck() {
        var chkJobChargeable = $("#chkJobChargeable");
        var chkChargeable = $("#chkChargeable");
        chkChargeable.checked = chkJobChargeable.checked;

    }

    function ChargeableCheck() {
        var chkChargeable = $("#chkChargeable");
        var chkJobChargeable = $("#chkJobChargeable");
        chkJobChargeable.checked = chkChargeable.checked;

    }
    $(document).ready(function () {
        // calculate_Time();

    });


</script>
